<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title></title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <script src="//code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>   -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script> -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script> -->
    <!-- <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw=" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script> -->
    <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/5ed507ef8aa53d8ecfea96d96bc7214cd2476fd2/FileSaver.min.js"></script> 
    <!-- <script src="/html2canvas.js"></script> -->
    <link href="/css/loading.css" rel="stylesheet" />
    <script src="//cdn.rawgit.com/rainabba/jquery-table2excel/1.1.0/dist/jquery.table2excel.min.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/sweetalert2@10"></script>
    <!-- <script src="/sweetalert2/dist/sweetalert2.js"></script>
    <link rel="stylesheet" type="text/css" href="/sweetalert2/dist/sweetalert2.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert2.scss"> -->
    <script src="https://fastly.jsdelivr.net/npm/inko@1.1.1/inko.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/guide.css">
    <!-- <script src="https://fastly.jsdelivr/npm/axios/dist/axios.min.js"></script> -->
    <script src="/axios/dist/axios.js"></script>
    <script src="/js/ajax_before_send.js"></script>
</head>

<style>
    .background{
        width:100%;
        position: relative;
        display: flex;
        padding-bottom: 80px;
    }
    .background::after{
        content : "";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        /*background-image: url( "/img2" );*/
        width: 100%;
        height: 100%;
        opacity : 0.4;
        z-index: -1;
    }
    @font-face { 
        font-family: 'Material Icons'; 
        font-style: normal; 
        font-weight: 400; 
        src: url(path/to/MaterialIcons-Regular.eot); 
        /* For IE6-8 */ 
        src: 
        local('Material Icons'), 
        local('MaterialIcons-Regular'), 
    }
    .material-icons { 
        font-family: 'Material Icons'; 
        font-weight: normal; 
        font-style: normal; 
        font-size: 24px; /* Preferred icon size */ 
        display: inline-block; 
        line-height: 1; 
        text-transform: none; 
        letter-spacing: normal; 
        word-wrap: normal; 
        white-space: nowrap; 
        direction: ltr; /* Support for all WebKit browsers. */ 
        -webkit-font-smoothing: antialiased; /* Support for Safari and Chrome. */ 
        text-rendering: optimizeLegibility; /* Support for Firefox. */ 
        -moz-osx-font-smoothing: grayscale; /* Support for IE. */ 
        font-feature-settings: 'liga'; }
    .title{
        width:100%;
        display:flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding-top:10px;
        padding-bottom:30px;
    }

    .title div:nth-child(2){
        display:flex;
        align-items: center;
        justify-content: center;
        margin:10px;
        border:1px solid #000000;
        border-radius: 3px;
        box-shadow:1px 1px 1px 1px #000000;
        padding:10px;
        cursor:pointer;
        height:12px;
        
    }

    .title div:nth-child(2):hover{
        background:linear-gradient( right, #89ecfd, #4f9bff, #a9d2eb );
        border:1px solid #65c1ff;
        border-radius: 2px;
        box-shadow:1px 1px 1px 1px #212f6e;
        
    }

    .maincontainer{
        width:70%;
        display:flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding-top:5px;
        padding-bottom:60px;
        font-weight: bold;
    }
    .maincontainer table{
        color:#000000;
    }
    .maincontainer table tr td{
        width:120px;
        height:20px;
        padding:1px;
    }
    .maincontainer table tr td input[type=button]{
        background:#ffffff;
        height:28px;
        margin:5px;
        border:1px solid #000000;
        border-radius: 3px;
        box-shadow:1px 1px 1px 1px #000000;
        font-size:15px;
        cursor:pointer;
    }

    .maincontainer table tr td input[type=button]:hover{
        background:linear-gradient( right, #89ecfd, #4f9bff, #a9d2eb );
        border:1px solid #65c1ff;
        border-radius: 2px;
        box-shadow:1px 1px 1px 1px #212f6e;
    }

    .maincontainer table tr td select{
        height:20px;
        width:150px;
    }
    .maincontainer table tr td:nth-child(1), .maincontainer table tr td:nth-child(3){
        text-align: center;
        /*background: linear-gradient( 45deg, #ffffff, #ffffff, #ffffff );*/
        border:1px solid #ffffff;
        border-radius: 2px;
        width:100px;
        font-size:13px;
        background: #1a2136;
        color:#fff;
    }
    .maincontainer table tr td:nth-child(2){
        /*background: linear-gradient( 45deg, #ffffff, #ffffff, #ffffff );*/
        text-align: center;
    }

    .signbox{
        display:none;
    }

    #signature { 
        background:#ffffff;
        border:1px solid #000; 
    }

    #save, #clear { 
        padding:5px 20px; border:0; color:rgb(255, 255, 255); background:#000; margin-top:5px; 
    }

    .back, .backcancle{
        display:flex;
        justify-content: center;
        align-items: center;
        background:#122459;
        width:300px;
        height:27px;
        margin:5px;
        /* border:1px solid #000000; */
        border-radius: 3px;
        /*box-shadow:1px 1px 1px 1px #000000;*/
        font-size:18px;
        font-weight: bold;
        cursor:pointer;
        color:#fff;
        box-shadow: 0 8px 9px -4px rgba(0, 0, 0, 0.3), 0 4px 18px 0 rgba(0, 0, 0, 0.2);

    }

    .back:hover, .backcancle:hover{
        background:linear-gradient( right, #89ecfd, #4f9bff, #a9d2eb );
        border:1px solid #65c1ff;
        border-radius: 2px;
        box-shadow:1px 1px 1px 1px #212f6e;
        color:rgb(101, 192, 83);
    }
    textarea{
        resize: none;
    }
    .w280{
        width:260px;
        height:20px;
    }
    .w150 {
        width: 150px;
        height: 20px;
    }

    /* Outer */
    .popup {
        width:100%;
        height:100%;
        display:none;
        position:fixed;
        top:0px;
        left:0px;
        background:rgba(0,0,0,0.3);
    }
    
    /* Inner */
    .popup-inner {
        max-width:800px;
        height:500px;
        width:100%;
        /*padding:40px;*/
        position:absolute;
        top:50%;
        left:50%;
        -webkit-transform:translate(-50%, -50%);
        transform:translate(-50%, -50%);
        box-shadow:0px 2px 6px rgba(0,0,0,1);
        border-radius:3px;
        background:#fff;
    }
    
    /* Close Button */
    .popup-close3 {
        width:30px;
        height:30px;
        padding-top:4px;
        display:inline-block;
        position:absolute;
        top:0px;
        right:0px;
        transition:ease 0.25s all;
        -webkit-transform:translate(50%, -50%);
        transform:translate(50%, -50%);
        border-radius:1000px;
        background:rgba(0,0,0,0.8);
        font-family:Arial, Sans-Serif;
        font-size:20px;
        text-align:center;
        line-height:100%;
        color:#fff;
    }
    
    .popup-close3:hover {
        -webkit-transform:translate(50%, -50%) rotate(180deg);
        transform:translate(50%, -50%) rotate(180deg);
        background:rgba(0,0,0,1);
        text-decoration:none;
    }

    /* Outer */
    .popup4 {
        width:100%;
        height:100%;
        display:none;
        position:fixed;
        top:0px;
        left:0px;
        background:rgba(0,0,0,0.3);
    }
    
    /* Inner */
    .popup4-inner {
        max-width:1000px;
        height:700px;
        width:100%;
        /*padding:40px;*/
        position:absolute;
        top:50%;
        left:50%;
        -webkit-transform:translate(-50%, -50%);
        transform:translate(-50%, -50%);
        box-shadow:0px 2px 6px rgba(0,0,0,1);
        border-radius:15px;
        background:#fff;
    }
    
    /* Close Button */
    .popup4-close {
        width:30px;
        height:30px;
        padding-top:4px;
        display:inline-block;
        position:absolute;
        top:0px;
        right:0px;
        transition:ease 0.25s all;
        -webkit-transform:translate(50%, -50%);
        transform:translate(50%, -50%);
        border-radius:1000px;
        background:rgba(0,0,0,0.8);
        font-family:Arial, Sans-Serif;
        font-size:20px;
        text-align:center;
        line-height:100%;
        color:#fff;
    }
    
    .popup4-close:hover {
        -webkit-transform:translate(50%, -50%) rotate(180deg);
        transform:translate(50%, -50%) rotate(180deg);
        background:rgba(0,0,0,1);
        text-decoration:none;
    }

    .rentdatebutton{
        background:#fff; 
        color:#000;
        cursor:pointer;
        border:1px solid #fff;
        font-weight: bold;
        border-radius: 5px;
        box-shadow:1px 1px 1px 1px #000000;
    }
    .rentdatebutton:hover{
        background:#CC414D; 
        color:#fff;
        border:1px solid #CC414D;
        border-radius: 5px;
    }
    .productload tr:nth-child(1),.productload2 tr:nth-child(1){
        background:#1a2136;
        color:#fff;
    }
    .cmtbtn{
        width: 60px;
        height: 30px;
        box-shadow: 0 8px 9px -4px rgba(0, 0, 0, 0.3), 0 4px 18px 0 rgba(0, 0, 0, 0.2);
        text-align: center;
        cursor: pointer;
        border-radius: 3px;
    }

    .cmtbtn:hover{
        box-shadow: 0 8px 9px -4px rgba(177, 177, 177, 0.3), 0 4px 18px 0 rgba(54, 9, 179, 0.2);
    }

    .footer{
    position: fixed;
    display: flex;
    justify-content: space-around;
    align-items: center;
    width:100%;
    left: 0;
    right: 0;
    bottom: 0;
    height: 7rem;
    background: #ffffff;
    }

    .footer>div{
        display: flex;
        padding:10px;
    }

    .footer>div>div{
        padding:10px;
    }

    .footerbutton1{
        width:180px;
        padding:15px;
        /* border:1px solid #000000; */
        border-radius: 5px;
        background:#fbffff;
        font-weight:bold;
        cursor: pointer;
        box-shadow: 0 8px 9px -4px rgba(0, 0, 0, 0.3), 0 4px 18px 0 rgba(0, 0, 0, 0.2);

    }
    .footerbutton1 span{
        font-size:15px;
    }
    .footerbutton1 span:nth-child(2){
        padding-left: 3%;
        font-size: 20px;
        color:#646464;
    }
    .topmenu tr td:nth-child(1) span:hover, .footerbutton1:hover{
        border:1px solid #CC414D;
        background:#fff;
    }


    .modal .btn{cursor: pointer;border: 1px solid #999999;text-align: center;border-radius: 5px;outline: none;font-weight: 500; margin: 10px;}
    .dimLayer{display: block;width: 100%;background-color: rgba(0, 0, 0, 0.3);position: fixed;left: 0;top: 0px;margin: 0;padding: 0;z-index: 9998;}
    .modal{width: 500px;height: 250px;border-radius: 10px;box-sizing: border-box;text-align: center;}
    .modal-section{background: #ffffff;box-sizing: border-box;display: none;position: absolute;top: 50%;left: 50%;-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);-moz-transform: translate(-50%, -50%);-o-transform: translate(-50%, -50%);transform: translate(-50%, -50%);display: none;z-index: 9999; border: 1px solid #ffffff; border-radius: 20px;}
    .menu_msg{font-size: 18px;font-weight: 500;}
    .enroll_btn{
        width: 100%;
        display: flex;
        justify-content: CENTER;
        ALIGN-ITEMS: center;
        height: 95px;
    }
    .gray_btn {width: 90px;background: #e77547;color: #ffffff;height: 36px;line-height: 36px;transition: 0.5s;font-size: 17px;}
    .white_btn {width: 90px;background: #ffffff;color: #000000;height: 36px;line-height: 36px;transition: 0.5s;font-size: 17px;}
    .pink_btn {width: 90px;background: #518ad6;color: #fff;height: 36px;line-height: 36px;transition: 0.5s;font-size: 17px;border: none;}

    @keyframes blink-effect { 50% { opacity: 0; } }
    .fbutton1{
        position:relative;
    }
    .alert1{
        position: absolute;
        top: -25px;
        left: -0px;
        animation: blink-effect 2s step-end infinite;
        font-weight: bold;
    }
    .alert1 span:nth-child(1){
        color:#fd5200;
        font-size:30px;
    }
    .alert1 span:nth-child(2){
        color:#313131;
        font-size:13px;
    }

    .title2{
        display:flex;
        align-items: center;
        font-size:15px;
    }
    .maincontainer2{
        font-weight: bold;
        font-size:13px;
        width:100%;
        height:100%;
        display:flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .maincontainer2 table{
        text-align: center;
        border-collapse: collapse;
    }

    .maincontainer2 table tr{
        border:1px solid #bdbdbd;
    }

    .maincontainer2 table tr:nth-child(2){
        border:2px solid #bdbdbd;
    }
    .maincontainer2 table tr td{
        /*border-top:1px solid #000000;*/
        padding:7px;
    }

    .search-form{
        display: flex;
        align-items: center;
    }
    .search-bar{
        height:30px;
    }
    .search-button{
        background:#ffffff;
        width:60px;
        height:33px;
        margin:5px;
        border:1px solid #000000;
        border-radius: 3px;
        box-shadow:1px 1px 1px 1px #000000;
        font-size:15px;
        cursor:pointer;
    }
    .pagingnum{
        font-size:15px;
        cursor:pointer;
        padding-left:5px;
        padding-right:5px;
        margin:3px;
        border:1px solid #000000;
        border-radius: 3px;
    }

    .active{
        cursor: pointer;
    }
    .tablescroll{
        overflow-y: scroll;
        width:85%;
        height:350px;
    }

    /* Outer */
    .popup2 {
        width:100%;
        height:100%;
        display:none;
        position:fixed;
        top:0px;
        left:0px;
        background:rgba(0,0,0,0.3);
    }

    /* Inner */
    .popup2-inner {
        max-width:1000px;
        height:600px;
        width:100%;
        /*padding:40px;*/
        position:absolute;
        top:50%;
        left:50%;
        -webkit-transform:translate(-50%, -50%);
        transform:translate(-50%, -50%);
        box-shadow:0px 2px 6px rgba(0,0,0,1);
        border-radius:3px;
        background:#fff;
    }

    /* Close Button */
    .popup2-close3 {
        width:30px;
        height:30px;
        padding-top:4px;
        display:inline-block;
        position:absolute;
        top:0px;
        right:0px;
        transition:ease 0.25s all;
        -webkit-transform:translate(50%, -50%);
        transform:translate(50%, -50%);
        border-radius:1000px;
        background:rgba(0,0,0,0.8);
        font-family:Arial, Sans-Serif;
        font-size:20px;
        text-align:center;
        line-height:100%;
        color:#fff;
    }

    .popup2-close3:hover {
        -webkit-transform:translate(50%, -50%) rotate(180deg);
        transform:translate(50%, -50%) rotate(180deg);
        background:rgba(0,0,0,1);
        text-decoration:none;
    }
    .popup2topmenu{
        width:100%;
        height:60px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        border-radius: 2px;
        box-sizing: border-box;
        background: #f79b76;
    }

    .container {
        display: table;
        height: 100%;
        width: 100%;
    }

    .buttons {
        display: table-cell;
        padding: 1em;
        text-align: center;
        vertical-align: middle;
    }

    [class*="btn-"] {
        position: relative;
        display: inline-block;
        width: 100%;
        color: #fff;
        font-size: 14px;
        font-weight: bold;
        line-height: 45px;
        margin-right:3em;
        max-width: 100px;
        text-decoration: none;
        text-transform: uppercase;
        vertical-align: middle;
    }

    /**
    * ===========================
    * @class : btn-1
    * ===========================
    */
    .btn-1 {
        letter-spacing: 0;
        -webkit-transition: all .28s ease-in-out;
        transition: all .28s ease-in-out;
    }
    .btn-1:hover,
    .btn-1:focus,
    .btn-1:active {
        letter-spacing: 5px;
    }
    .btn-1:after,
    .btn-1:before {
        border: 1px solid rgba(255, 255, 255, 0);
        bottom: 0;
        content: " ";
        display: block;
        margin: 0 auto;
        position: relative;
        -webkit-transition: all .18s ease-in-out;
        transition: all .18s ease-in-out;
        width: 0;
    }
    .btn-1:hover:after,
    .btn-1:hover:before {
        border-color: #fff;
        -webkit-transition: width 250ms ease-in-out;
        transition: width 250ms ease-in-out;
        width: 70%;
    }
    .btn-1:hover:before {
        bottom: auto;
        top: 0;
    }

    .maincontainer2:nth-child(2){
        height:auto;
    }
    .on{
        border-radius: 6px;
        background:#4b4b4b;
    }
    .active2{
        font-size:13px;
    }
    .flex{
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .flexs{
        display: flex;
        justify-content: flex-start;
        align-items: center;
    }

    .flexcolumns{
        width:100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
    }
    .minibuttonui{
        font-size:11px;
        padding:3px;
        border:1px solid #000000;
        border-radius: 5px;
        background-color: #ffffff;
        cursor: pointer;
        margin:2px;
    }
    .countchk{
        cursor: pointer;
        font-size:19px;
        color:#ff1100;
    }
    .popup2container{
        height:600px;
        overflow-y:unset;
    }

    .maincontainer-3{
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
        padding-top: 5px;
        padding-bottom: 25px;
        padding-left: 20px;
        padding-right: 20px;
        font-weight: bold;
    }

    .maincontainer-3title{
        display: flex;
        justify-content: center;
        align-items: center;
        padding-top:40px;
        width:100%;
        height:50px;
        font-size:17px;
        text-align: center;
    }

    .maincontainer-3title span:nth-child(1){
        font-size:25px;
    }

    .maincontainer-3title span:nth-child(2){
        font-weight: bold;
    }

    .maincontainer-3 table{
        width:100%;
        border-collapse: collapse;
        text-align: center;
    }

    .maincontainer-3 table tr{
        border:1px solid #000000;
    }

    .addbox{
        margin:15px;
        font-size:42px; 
        color:#444444; 
        cursor: pointer;
        border: 0 solid;
        border-radius: 5px;
        box-shadow: inset 0 0 20px rgba(255, 255, 255, 0);
        outline: 1px solid rgba(255, 255, 255, 0.5);
        -webkit-transition: all 0.25s cubic-bezier(1.19, 1, 0.22, 1);
        transition: all 0.25s cubic-bezier(0.19, 1, 0.22, 1);
    }
    .addbox:hover{
            box-shadow: inset 0 0 40px rgba(255, 255, 255, 0.5), 0 0 40px rgba(255, 255, 255, 0.2);
            outline-color: rgba(255, 255, 255, 0);
            outline-offset: 25px;
            font-size: 44px;
            text-shadow: 1px 1px 2px #000000;
    }
    .deletebutton{
        width:100%;
        display:flex;
        justify-content: space-between;
        margin:5px;
    }

    .deletebutton span{
        cursor: pointer;
        border:1px solid #000000;
        border-radius: 5px;
        padding:5px;
    }

    .deletebutton span:hover{
        border:1px solid #4f9bff;
    }
    .f12{
        font-size:12px;
    }
    .mobile{
        display:table-cell;
    }

    /*====================*/
    /* BUZZ OUT
    /*====================*/

    @-webkit-keyframes buzz-out-on-hover {
    10% {
        -webkit-transform: translateX(3px) rotate(2deg);
        transform: translateX(3px) rotate(2deg);
    }
    20% {
        -webkit-transform: translateX(-3px) rotate(-2deg);
        transform: translateX(-3px) rotate(-2deg);
    }
    30% {
        -webkit-transform: translateX(3px) rotate(2deg);
        transform: translateX(3px) rotate(2deg);
    }
    40% {
        -webkit-transform: translateX(-3px) rotate(-2deg);
        transform: translateX(-3px) rotate(-2deg);
    }
    50% {
        -webkit-transform: translateX(2px) rotate(1deg);
        transform: translateX(2px) rotate(1deg);
    }
    60% {
        -webkit-transform: translateX(-2px) rotate(-1deg);
        transform: translateX(-2px) rotate(-1deg);
    }
    70% {
        -webkit-transform: translateX(2px) rotate(1deg);
        transform: translateX(2px) rotate(1deg);
    }
    80% {
        -webkit-transform: translateX(-2px) rotate(-1deg);
        transform: translateX(-2px) rotate(-1deg);
    }
    90% {
        -webkit-transform: translateX(1px) rotate(0);
        transform: translateX(1px) rotate(0);
    }
    100% {
        -webkit-transform: translateX(-1px) rotate(0);
        transform: translateX(-1px) rotate(0);
    }
    }
    @keyframes buzz-out-on-hover {
    10% {
        -webkit-transform: translateX(3px) rotate(2deg);
        transform: translateX(3px) rotate(2deg);
    }
    20% {
        -webkit-transform: translateX(-3px) rotate(-2deg);
        transform: translateX(-3px) rotate(-2deg);
    }
    30% {
        -webkit-transform: translateX(3px) rotate(2deg);
        transform: translateX(3px) rotate(2deg);
    }
    40% {
        -webkit-transform: translateX(-3px) rotate(-2deg);
        transform: translateX(-3px) rotate(-2deg);
    }
    50% {
        -webkit-transform: translateX(2px) rotate(1deg);
        transform: translateX(2px) rotate(1deg);
    }
    60% {
        -webkit-transform: translateX(-2px) rotate(-1deg);
        transform: translateX(-2px) rotate(-1deg);
    }
    70% {
        -webkit-transform: translateX(2px) rotate(1deg);
        transform: translateX(2px) rotate(1deg);
    }
    80% {
        -webkit-transform: translateX(-2px) rotate(-1deg);
        transform: translateX(-2px) rotate(-1deg);
    }
    90% {
        -webkit-transform: translateX(1px) rotate(0);
        transform: translateX(1px) rotate(0);
    }
    100% {
        -webkit-transform: translateX(-1px) rotate(0);
        transform: translateX(-1px) rotate(0);
    }
    }
    .buzz-out-on-hover {
    display: inline-block;
    vertical-align: middle;
    -webkit-transform: perspective(1px) translateZ(0);
    transform: perspective(1px) translateZ(0);
    box-shadow: 0 0 1px rgba(0, 0, 0, 0);
    }
    .buzz-out-on-hover:hover, .buzz-out-on-hover:focus, .buzz-out-on-hover:active {
    -webkit-animation-name: buzz-out-on-hover;
    animation-name: buzz-out-on-hover;
    -webkit-animation-duration: 0.75s;
    animation-duration: 0.75s;
    -webkit-animation-timing-function: linear;
    animation-timing-function: linear;
    -webkit-animation-iteration-count: 1;
    animation-iteration-count: 1;
    }

    .maincontainer-3 table tr td input{
        width:30px;
        height:20px;
        text-align: center;
    }
    .totaltable{
        background-color: #ffffff;
    }
    .cmttxt{
        width:300px;
    }
    .relookup{
        font-weight: bold;
        padding: 8px 20px 10px 20px;
        margin-bottom: 10px;
        margin-left: 10px;
        border-radius: 5px;
        cursor: pointer;
        color: #000;
        box-shadow: 0 8px 9px -4px rgba(0, 0, 0, 0.3), 0 4px 18px 0 rgba(0, 0, 0, 0.2);
    }
    .relookup:hover{
        box-shadow: 0 8px 9px -4px rgba(16, 86, 192, 0.3), 0 4px 18px 0 rgba(8, 87, 206, 0.2);
    }
    .reloading{
        position: absolute;
        right: 25%;
        top: 45%;
    }

    .sgreen{
        color:#0d8832;
    }
    .sred{
        color:#ff0000;
    }
    .sorange{
        color:#e28228;
    }

    @media (max-device-width: 600px) {
        .background{
            flex-direction:column;
            padding-bottom:120px;
        }
        .maincontainer{
            width:100%;
            order:2
        }
        .maincontainer table tr td{
            width:100px;
        }
        .maincontainer table tr td input {
            width:100px;
        }
        .maincontainer table tr td:nth-child(1){
            width:50px;
            font-size:10px;
        }
        .maincontainer table tr td:nth-child(3){
            width:30px;
            font-size:10px;
        }
        .w280{
            width:200px;
        }
        .maincontainer table tr td select{
            width:110px;
        }
        .reqeustmemo{
            width:260px;
        }
        .maincontainer-2{
            display:none;
        }
        .maincontainer-3{
            font-size:10px;
            padding-left:0px;
            padding-right:0px;
            order:1;
        }
        .active2{
            font-size:10px;
        }
        .footer{
            flex-direction: column;
            height:10rem;
        }
        .footerbutton1{
            width:90px;
        }
        .maincontainer-3title{
            padding-top:20px;
        }
        .confirmtable{
            width:100%;
            font-size:15px;
        }
        .chking{
            width:20px;
            transform:scale(1.3);
            -webkit-transform:scale(1.3);
        }
        .footer>div>div{
            padding:1px;
        }
        .footerbutton1 span{
            font-size: 10px;
        }
        .f12{
            font-size:10px;
        }
        .mobile{
            display:none;
        }
        .swal2-content{
            padding:0px;
        }
        .cbcode{
            font-size:14px;
            width:100px;
        }
        .alert1 span:nth-child(2) {
            font-size:10px;
        }
        input{
            font-size:10px;
        }
        .cmttxt{
            width:230px;
        }
        .maincontainer-3title span:nth-child(1){
            font-size:15px;
        }
        .back{
            width: 260px;
            height: 20px;
        }
    }

    .print1footer{
        display:flex;
        justify-content: space-between;
        align-items: center;
        position:fixed;
        height:50px;
        width:100%;
        bottom:0;
        background: #ffffff;
    }

    .print1footer div{
        display: flex;
    }

    .print1footer div div{
        display: flex;
        margin:10px;
        padding:5px;
        border:1px solid #797979;
        border-radius: 3px;
        cursor: pointer;
    }

    .print1footer div div:hover{
        background:linear-gradient( right, #89ecfd, #4f9bff, #a9d2eb );
        border:1px solid #65c1ff;
        border-radius: 2px;
        box-shadow:1px 1px 1px 1px #212f6e;
    }

    .print1footer div:nth-child(1) div:hover{
        background:linear-gradient( right, #89ecfd, #4f9bff, #a9d2eb );
        border:1px solid #000000;
        border-radius: 2px;
        box-shadow:1px 1px 1px 1px #212f6e;
    }

    .print1footer div span{
        padding-left:5px;
    }
    
    .red{
        color:#ff5757;
    }

    .blue{
        color:#ffa357;
    }
    .green{
        color:#006b20;
    }
    .on{
        background: #4d4d4d;
        color:#ffffff;
    }
    .off{
        background: #ffffff;
    }

    .confirmtable{
        border-collapse: collapse;
    }
    .confirmtable tr{
        border:1px solid #797979;
    }
    .confirmtable tr td{
        padding:5px;
        font-weight: bold;
    }
    .confirmtable tr td input[type="checkbox"]{
        transform: scale(1.7);
    }

    .flexcol{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding:10px;
    }
    .flexcol span{
        padding-top:10px;
    }

    .nrent_swal_table{
        font-size: 23px;
        font-weight: bold;
        margin: 20px;
    }

    .nrent_swal_table tbody tr td{
        padding-right:10px;
    }

    .need_area{
        width:80%;
        
    }
    .need_write_btn{
        display:flex;
        align-items: center;
        justify-content: center;
        cursor:pointer;
        border-radius: 5px;
        font-weight: bold;
        width: 150px;
        margin-left:15px;
        height: 40px;
        background: #fff;
        color:#000;
        box-shadow: 0 8px 9px -4px rgb(59 113 202 / 30%), 0 4px 18px 0 rgb(59 113 202 / 20%);
    }

    .need_write_btn:hover{
        box-shadow: 0 8px 9px -4px rgba(5, 20, 46, 0.3), 0 4px 18px 0 rgba(1, 13, 31, 0.2);
        opacity:0.8;
    }

    .need_tr{
        border:1px solid #000;
        border-radius: 5px;
    }

    .need_tr{
        cursor:pointer;
    }
    .need_tr:hover{
        background:#e4e4e4;
    }

    .need_date{
        text-align: center;
        width:100px;
        height:20px;
    }

    .need_result_txt{
        text-align: center;
        width:70%;
        height:25px;
        overflow: hidden;
    }
    .need_colum{
        background:#ececec;
        border-radius: 5px;
        font-size:18px;
        /* display: flex;
        justify-content: center; */
    }

    .tg  {
        border-collapse:collapse;
        border-spacing:0;
        font-weight:bold;
    }
    .tg td{
        font-family:Arial, sans-serif;
        font-size:14px;
        overflow:hidden;
        padding:10px 5px;
        word-break:normal;
    }
    .tg th{
        font-family:Arial, sans-serif;
        font-size:14px;
        font-weight:bold;
        overflow:hidden;
        padding:10px 5px;
        word-break:normal;
    }
    .tg .tg-c3ow{
        border-color:inherit;
        text-align:center;
        vertical-align:top;
    }
    .tg .tg-0pky{
        border-color:inherit;
        text-align:left;
        vertical-align:top;
    }
    .tg .tg-0lax{
        text-align:left;
        vertical-align:top;
    }

    .need_write_textarea{
        width:95%;
        height:100px;
        font-size:15px;
    }

    .need_write_chkbox{
        width:20px;
        height:20px;
    }

    .clean_chk{
        height: 30px;
        width: 60px;
        font-weight: bold;
        font-size: 15px;
    }

    .flexcloumn{
        display:flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .switch-container {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 27px;
    }

    .switch-input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .switch-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
        border-radius: 34px;
    }

    .switch-slider:before {
        position: absolute;
        content: "";
        height: 21px;
        width: 21px;
        left: 4px;
        bottom: 3px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
        border-radius: 50%;
    }
    .switch-slider label {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: transparent;
        -webkit-transition: .4s;
        transition: .4s;
    }

    input:checked + .slider label.on {
    color: black;
    }

    input:not(:checked) + .slider label.off {
    color: black;
    }

    .switch-input:checked + .switch-slider {
        background-color: rgb(91, 179, 89);
    }

    .switch-input:focus + .switch-slider {
        box-shadow: 0 0 1px rgb(91, 179, 89);
    }

    .switch-input:checked + .switch-slider:before {
        -webkit-transform: translateX(68px); /* 너비가 100px이므로 70px로 설정 */
        -ms-transform: translateX(68px);
        transform: translateX(68px);
    }
    .order_move_button{
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border-radius: 5px;
        font-weight: bold;
        width: 150px;
        margin-left: 15px;
        height: 40px;
        background: #fff;
        color: #000;
        box-shadow: 0 8px 9px -4px rgba(0, 43, 115, 0.3), 0 4px 18px 0 rgba(0, 23, 62, 0.2);
    }
    @media (max-device-width: 600px) {
        .confirmtable tr td {
            padding:3px;
        }
    }
</style>

<body>
    <script>
        function Mobile() {return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);}
        function ymdformat(x){
            var tval = x.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3');
            return tval;
        }

        function dateFormat(date) {
            let month = date.getMonth() + 1;
            let day = date.getDate();
            let hour = date.getHours();
            let minute = date.getMinutes();
            let second = date.getSeconds();

            month = month >= 10 ? month : '0' + month;
            day = day >= 10 ? day : '0' + day;
            hour = hour >= 10 ? hour : '0' + hour;
            minute = minute >= 10 ? minute : '0' + minute;
            second = second >= 10 ? second : '0' + second;

            return date.getFullYear() + '-' + month + '-' + day;
        }
        
        function phoneNumber(value) {
            if (!value) {
                return "";
            }

            value = value.replace(/[^0-9]/g, "");

            let result = [];
            let restNumber = "";

            // 지역번호와 나머지 번호로 나누기
            if (value.startsWith("02")) {
                // 서울 02 지역번호
                result.push(value.substr(0, 2));
                restNumber = value.substring(2);
            } else if (value.startsWith("1")) {
                // 지역 번호가 없는 경우
                // 1xxx-yyyy
                restNumber = value;
            } else {
                // 나머지 3자리 지역번호
                // 0xx-yyyy-zzzz
                result.push(value.substr(0, 3));
                restNumber = value.substring(3);
            }

            if (restNumber.length === 7) {
                // 7자리만 남았을 때는 xxx-yyyy
                result.push(restNumber.substring(0, 3));
                result.push(restNumber.substring(3));
            } else {
                result.push(restNumber.substring(0, 4));
                result.push(restNumber.substring(4));
            }

            return result.filter((val) => val).join("-");
        }
        
        var uid = '<%=username%>';
        var key = '<%=key%>';
        var company = '<%=company%>';
        var resultchk = '<%=result[0].chk%>';
        var rentstatus = '<%=result[0].status%>';
        var orderkey = '<%=result[0].orderkey%>';
        var socket = '';
        const Toast = Swal.mixin({
            toast: true,
            position: "top",
            showConfirmButton: false,
            timer: 5000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
            }
        });

        var socket_chk = 0;

        function socekt_start(){
            socket = io();
            socket.on('go_lookup_res', async function(data) {
                $('.maincontainer-3').show();
                $('.reloading').hide();
                //console.warn(data.name)
                if(data.name=="death"){
                    Swal.fire('자격상실수급자');
                }else if(data.name=="errorsession"){
                    Toast.fire({
                        icon: "warning",
                        title: "공단로그인창을 실행해주세요"
                    });
                        //Swal.fire('공단로그인창을 실행해주세요');
                }else if(data.name=="error"){
                    
                }else{
                    location.reload();
                    
                }
                
            });
            // socket.on('message2', function(data) {
            //     location.reload();
            //     $('.maincontainer-3').show();
            //     $('.reloading').hide();
            // });
            // if(socket_chk==1){
                socket.on('rentstopcancle2',function(data){
                    if(socket_chk==1){
                        socket_chk = 0;
                        $.ajax({
                            url: "/rentstopcancle",
                            data: "id=" + uid + "&company=" + company+ "&num="+key + "&orderkey=<%=result[0].orderkey%>",
                            type: 'POST',
                            dataType: "JSON",
                            success: function (result) {
                                if(result.code==200){
                                Swal.fire(
                                    '중지 취소처리되었습니다.',
                                    '',
                                    'success'
                                ).then((result) => {
                                    if (result.isConfirmed) {
                                        location.reload();
                                        }
                                    });
                                }else{
                                    Swal.fire(
                                        '중지주문이 없습니다.',
                                        '',
                                        'error'
                                    );
                                }
                            },
                            error: function(request, status, error) { // 오류가 발생했을 때 호출된다.
                                if(error === 'timeout'){
                                    Swal.fire(
                                        '재시도 해주세요',
                                        '',
                                        'error'
                                    );
                                }else{
                                    Swal.fire(
                                        '서버 오류 재시도 해주세요',
                                        '',
                                        'error'
                                    );
                                }
                            }
                            ,timeout: 5000 
                        });
                    }
                });
                socket.on('rentrestart2',function(data){
                    if(socket_chk==1){
                        socket_chk = 0;
                        $.ajax({
                            url: "/rentrestart2",
                            data: "id=" + uid + "&company=" + company+ "&num="+key + "&orderkey=<%=result[0].orderkey%>",
                            type: 'POST',
                            dataType: "JSON",
                            success: function (result) {
                                if(result.code==200){
                                Swal.fire(
                                    '대여 중지 재시작 완료 처리되었습니다',
                                    '',
                                    'success'
                                ).then((result) => {
                                    if (result.isConfirmed) {
                                        location.reload();
                                        }
                                    });
                                }else{
                                    Swal.fire(
                                        '중지재시작 주문이 없습니다.',
                                        '',
                                        'error'
                                    );
                                }
                            },
                            error: function(request, status, error) { // 오류가 발생했을 때 호출된다.
                                if(error === 'timeout'){
                                    Swal.fire(
                                        '재시도 해주세요',
                                        '',
                                        'error'
                                    );
                                }else{
                                    Swal.fire(
                                        '서버 오류 재시도 해주세요',
                                        '',
                                        'error'
                                    );
                                }
                            }
                            ,timeout: 5000 
                        });
                    }
                });
                socket.on('rentstop2',function(data){
                    if(socket_chk==1){
                        socket_chk = 0;
                        var datasplit=data.split(";");
                        if(datasplit[0]=='y'){
                            $.ajax({
                                url: "/rentstop",
                                data: "id=" + uid + "&number=<%=result[0].number%>&name=<%=result[0].name%>&target=<%=result[0].target%>&product=<%=result[0].productname%>&company=" + company+ "&num="+key + "&orderkey=<%=result[0].orderkey%>"+ "&car=&cancled="+datasplit[3].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3')+ "&canclet="+datasplit[8]+"&undocancle="+datasplit[7],
                                type: 'POST',
                                dataType: "JSON",
                                success: function (result) {
                                    if(result.code==200){
                                    Swal.fire(
                                        '중지처리되었습니다.',
                                        '',
                                        'success'
                                    ).then((result) => {
                                    if (result.isConfirmed) {
                                        location.reload();
                                        }
                                    });
                                    }else{
                                    Swal.fire(
                                            '중지주문이 없습니다.',
                                            '',
                                            'error'
                                        );
                                    }
                                },
                                error: function(request, status, error) { // 오류가 발생했을 때 호출된다.
                                    if(error === 'timeout'){
                                        Swal.fire(
                                            '재시도 해주세요',
                                            '',
                                            'error'
                                        );
                                    }else{
                                        Swal.fire(
                                            '서버 오류 재시도 해주세요',
                                            '',
                                            'error'
                                        );
                                    }
                                }
                                ,timeout: 5000 
                            });
                        }
                    }
                });
                socket.on('rentcontract2', function(data) {
                    if(socket_chk==1){
                    socket_chk = 0;
                    if(window.parent.guide_chk==8){
                        window.parent.guide_on_ordermodify_2_3();
                    }
                    var datasplit=data.split(";");
                    var title = "계약실패";
                    var icon = "error";
                    console.log(datasplit)

                        if(datasplit[0]=='y'){
                            $.ajax({
                                url: "/rentcontract",
                                data: "id=" + uid + "&company="+company+ "&key=<%=key%>"+ "&bcode="+datasplit[2].replace(/\[|\]|\'/,'')+ "&edate2="+ymdformat(datasplit[3]).replace(/\[|\]|\'/,'')+ "&chk="+datasplit[4]+ "&num="+orderkey,
                                type: 'POST',
                                dataType: "JSON",
                                success: function (result) {
                                    if(result){
                                            if(datasplit[4]=='cok'&&datasplit[6]=='n'){
                                                if(datasplit[2].includes(',')){
                                                    var bcodearrsplit = datasplit[2].split(',');
                                                    $.each(bcodearrsplit,function(i){
                                                        $.ajax({
                                                            url:"/bcodelistmodify",
                                                            data:"company="+company+"&buybcode="+bcodearrsplit[i].replace(/\[|\]|\'| /g,'')+"&contractselect=cok" + "&buycode="+datasplit[5],
                                                            type:'POST',
                                                            dataType:"JSON",
                                                            async:false,
                                                            error : function(error) {
                                                                console.warn(error);
                                                            },
                                                            success:function(results){
                                                                if(results)console.warn(results);
                                                            },complete: () => {
                                                                console.warn('a');
                                                            }
                                                        })
                                                    });
                                                }else{
                                                    sleep(i*1000).then(() => 
                                                    $.ajax({
                                                        url:"/bcodelistmodify",
                                                        data:"company="+company+"&buybcode="+datasplit[2].replace(/\[|\]|\'| /g,'')+"&contractselect=cok" +"&buycode="+datasplit[5],
                                                        type:'POST',
                                                        dataType:"JSON",
                                                        //async:false,
                                                        success:function(results){
                                                            if(results)console.warn(results);
                                                        }
                                                    })
                                                    );
                                                }
                                            }
                                        }
                                    }
                                });
                            }
                        if(datasplit[0]=='y'){
                            title = "계약성공";
                            icon = 'success';
                        }
                        if(datasplit[0]=='m'){
                            socket_chk = 1;
                            Swal.fire({
                                    title: datasplit[1],
                                    showConfirmButton:false,
                                    didOpen: () => {
                                        Swal.showLoading()
                                    },
                                    allowOutsideClick: false,
                                });
                        }else{
                            Swal.fire({
                            icon: icon,
                            title: title,
                            text: datasplit[1],
                            }).then((result) => {
                                    if (result.isConfirmed) {
                                        location.reload();
                                    }
                            });
                        }
                    }
                    
                });
            // }
            

            socket.emit('login', {'name': uid});
            // socket.emit('vschk', {'name': uid,'msg':'91.8'});
            // socket.on('vschkre', function(data) {

            //     console.log(data);
                
            //     if(String('91.8')!=String(data)){
            //         Swal.fire({
            //         width: '550px',
            //         fontsize:'20px',
            //         title: '프로그램을 재실행해주세요',
            //         text: "실행중인 프로그램이 현재 한큐 최신버전이 아닙니다.(2024-04-29 15:20 취소계약 오류 업데이트 수정)",
            //         icon: 'info',
            //         showCancelButton: true,
            //         showConfirmButton:false,
            //         confirmButtonColor: '#3085d6',
            //         cancelButtonColor: '#d33',
            //         confirmButtonText: '닫기',
            //         cancelButtonText: '취소',
            //         allowOutsideClick: false,
            //     }).then((result) => {
            //         if (result.isConfirmed) {
            //         }
            //     });
            //     socket_end();
            //         // toastr.options.positionClass = "toast-top-right";
            //         // toastr.options.closeButton = false;
            //         // toastr.options.timeOut = 99999999;
            //         // toastr.options.extendedTimeOut = 99999999;
            //         // toastr.options.onclick = function () { 
                        
            //         // }
            //         // toastr.warning('신규버전 업데이트로 프로그램을 재실행하시길바랍니다.','버전업데이트 공지');
            //         // document.getElementsByClassName("toast")[0].style.marginTop = "25px";
            //     }
            // });
        }
        
        function socket_end(){
            socket.disconnect();
            //console.warn('discon')
        }
        
        $(document).ready(function(){
            $.ajax({
                url:'/rentstoptable',
                data:'company=<%=result[0].company%>&key='+key,
                dataType:'JSON',
                type:'POST',
                success:function(result){
                    if(result.code==200){
                        if(result.data[0].text!=''){
                            $('.rentstoptxt').append('('+result.data[0].text+'&nbsp;&nbsp;'+result.data[0].stopdates+'&nbsp;~&nbsp;)');
                        }
                    }
                }
            });
            $(".n").hide();
            $(".m").hide();
            if(resultchk == "ok" && (rentstatus == "end" || rentstatus == "wait" || rentstatus == "back"|| rentstatus == "backend" || rentstatus == 'null')){
                $(".ok").hide();
                $(".n").show();
                $(".m").hide();
            }else if(resultchk == "ok" && rentstatus == "backend" ){
                $(".ok").show();
                //$(".m").show();
                $(".m").hide();
                $(".n").hide();
                $("#submit").hide();
            }else if(resultchk == "cok" && (rentstatus == "back"||rentstatus == "backend")){
                $(".m").show();
            }else if(resultchk == "" || resultchk == "cok"){
                $(".ok").show();
                $(".n").hide();
                $(".m").hide();
            }
            
            if(rentstatus == "back" ||rentstatus == "backend"){
                $(".back").hide();
                $('.backcancle').show();
            }else{
                $(".back").show();
                $('.backcancle').hide();
            }
            $.datepicker.setDefaults({
                dateFormat: 'yymmdd',
                prevText: '이전 달',
                nextText: '다음 달',
                monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
                monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
                dayNames: ['일', '월', '화', '수', '목', '금', '토'],
                dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
                dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
                showMonthAfterYear: true,
                yearSuffix: '년'
            });
            $( "#datepicker,#datepicker2,#datepicker3,#datepicker5" ).datepicker({
                changeMonth: true,
                changeYear: true
            });
            $( "#datepicker,#datepicker2,#datepicker3,#datepicker5" ).datepicker( "option", "showAnim", "slide" );
            $('.signbutton').click(function(){
                $(".signbox").slideDown();
            })


            // var canvas = $("#signature")[0];
            // var signature = new SignaturePad(canvas, {
            //     minWidth : 2,
            //     maxWidth : 2,
            //     penColor : "rgb(0, 0, 0)"
            // });
            
            // $("#clear").on("click", function() {
            //     signature.clear();
            // });
            $("input").on('propertychange change keyup paste input', function(){
                $(this).css("border","2px solid #ff8c5e");
            });

            $(".phone1").on("input", function(){
                $(".phone2").val($(".phone1").val());
            });
            /*
            $(".lastlookup").click(function(){
                $.ajax({
                    type: 'GET',
                    url: '/lastlookup?username='+uid,
                    //cache: false,
                    //data: "data=" + data,
                    dataType: "JSON", 
                    //processData: false,
                    //contentType: false,
                    success: function (data) {
                        //alert(data.message);
                        $('.name').val(data.message.name).css("border","1px solid #ff9900");
                        let str = data.message.number;
                        var strl = '';
                        if(str.match("L")) strl=''; else strl='L';
                        $('.number').val(strl+data.message.number).css("border","1px solid #ff9900");
                        $('.regident').val(data.message.regident).css("border","1px solid #ff9900");
                        $('.ranker').val(data.message.ranker).css("border","1px solid #ff9900");
                        $('.target').val(data.message.target.substring(0, 2)).css("border","1px solid #ff9900");
                        datenowsplit = data.message.datenow.split('~');
                        var reg = /[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi
                        datenowreplace1=datenowsplit[0].replace(reg,'');
                        datenowreplace2=datenowsplit[1].replace(reg,'');
                        $('.date1').val(datenowreplace1).css("border","1px solid #ff9900");
                        $('.date2').val(datenowreplace2).css("border","1px solid #ff9900");
                        $(".sale").val(data.message.target.substring(2, 7).replace(/ /g, "")).prop("selected", true).css("border","1px solid #ff9900");
                        //$('.sale').val(data.message.target.substring(2, 6).trim());
                        //alert('불러오기 완료!');
                        $('.lastlookup span:last').html('done_outline');
                    }
                    });
            });
            */
            $("#addresschk").click(function(){
                document.getElementById("sample3_postcode").value = document.getElementById("sample2_postcode").value;
                document.getElementById("sample3_address").value = document.getElementById("sample2_address").value;
                document.getElementById("sample3_detailAddress").value = document.getElementById("sample2_detailAddress").value;
            });

            $(".lastlookup").click(function(){
                orderup("<%=pagenum%>");
                //window.frames['clientup'].location.reload();
                var targeted_popup_class = $('[data-popup-open]').attr('data-popup-open');
                $('[data-popup="' + targeted_popup_class + '"]').fadeIn(350);
            });

            $(function() {
            //----- CLOSE
            $('[data-popup-close]').on('click', function(e) {
                var targeted_popup_class = jQuery(this).attr('data-popup-close');
                $('[data-popup="' + targeted_popup_class + '"]').fadeOut(350);

                e.preventDefault();
            });
            });

            $(".addbox").click(function(){
                if($('.name').val()!=''){
                orderupproduct("<%=pagenum%>");
                //window.frames['clientup'].location.reload();
                var targeted_popup_class = $('[data-popup-open2]').attr('data-popup-open2');
                $('[data-popup="' + targeted_popup_class + '"]').fadeIn(350);
                }else{
                    $('.maincontainer').effect( "shake" );
                    Swal.fire(
                        '주문서를 작성해주세요',
                        '',
                        'warning'    
                    );
                    //alert('주문서를 작성해주세요');
                }
            });
            $(function() {
                //----- CLOSE2
                $('[data-popup-close2]').on('click', function(e) {
                    var targeted_popup_class = jQuery(this).attr('data-popup-close2');
                    $('[data-popup="' + targeted_popup_class + '"]').fadeOut(350);

                    e.preventDefault();
                });

                //----- CLOSE4
                $('[data-popup-close4]').on('click', function(e) {
                    var targeted_popup_class = jQuery(this).attr('data-popup-close4');
                    $('[data-popup4="' + targeted_popup_class + '"]').fadeOut(350);

                    e.preventDefault();
                });
        
            });

            //오늘일자입력
            var now = new Date();

            var year= now.getFullYear();
            var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
            var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
                    
            var chan_val = year + mon + day;
            $('#datepicker').val(chan_val);
            $('.gray_btn').hide();
            var orderdate = "<%=result[0].orderdate.split(' ')[0]%>";
            $('#datepicker').val(orderdate);
            var sale = "<%=result[0].sale%>";
            var manager = "<%=result[0].manager%>";
            var deliverymanager = "<%=result[0].deliverymanager%>";
            var deliverymanager2 = '';
            if(deliverymanager=="basic"){
                deliverymanager2='택배';
            }else{
                deliverymanager2='물류';
            }
            var status = "<%=result[0].status%>";
            var number = "<%=result[0].number%>";
            var statustxt = '';
            $(".sale").append("<option value='"+ sale+"'>" + sale + "</option>");
            $(".sale").val(sale).prop("selected", true);
            if(status=="wait"){
                statustxt = "배송대기";
            }else if(status=="end"){
                statustxt = "배송완료";
            }else if(status=="back"){
                statustxt = "회수중";
            }else if(status=="backend"){
                statustxt = "회수완료";
            }
            $(".state").append("<option value='"+ status+"'>" + statustxt + "</option>");
            $(".state").val(status).prop("selected", true);
            $(".manager").append("<option value='"+ manager+"'>" + manager + "</option>");
            $(".manager").val(manager).prop("selected", true);
            $(".deliverymanager").append("<option value='"+ deliverymanager+"'>" + deliverymanager2 + "</option>");
            $(".deliverymanager").val(deliverymanager).prop("selected", true);
            $(".signimage").empty();
            $(".statetable input").attr("disabled",true); 
            if(resultchk == "ok")$('.alert1').hide(); else $('.alert1').show();
            cmtview();
            if(Mobile()==true){
                $('.mobile').css("display","none");
            }
        });//document.ready end

        function cmtdel(x){
            $.ajax({
                url:"/cmtdel",
                data:"company="+company+"&cmtkey="+x,
                type:'POST',
                dataType:"JSON",
                success:function(results){
                    $('.cmtdiv').remove();
                    cmtview();
                }
            });
        }
    
        function cmtview(){
            var dstr = '';
            $.ajax({
                url:"/cmtview",
                data:"company="+company+"&orderkey=<%=result[0].orderkey%>",
                type:'POST',
                dataType:"JSON",
                async:false,
                success:function(results){
                    if(results){
                        $.each(results.results,function(i){
                            if(results.results[i].id==uid){
                                dstr = '<div class="cmtdel" style="font-size:12px; cursor:pointer;" onclick="cmtdel(\''+results.results[i].num+'\');">삭제</div>';
                            }else{
                                dstr ='';
                            }
                            $('.cmtbox').append('<div class="cmtdiv flexcolumns" style="padding-bottom:10px;" id="'+results.results[i].num+'"><div class="flex"><div style="color:#5D5D5D;">'+results.results[i].manager+'</div>&nbsp;&nbsp;&nbsp;<div style="font-size:12px;">'+results.results[i].date+'</div>&nbsp;&nbsp;&nbsp;'+dstr+'</div><div style="text-align:start">'+results.results[i].text+'</div></div>');
                        });
                    }
                }
            });
        }

        function centerkey(s) {
            if(s==1){
                if($('.cmttxt').val()!=''){
                    $.ajax({
                        url:"/cmtinsert",
                        data:"company="+company+"&orderkey=<%=result[0].orderkey%>"+"&id="+uid+"&txt="+$('.cmttxt').val()+"&manager=<%=managername%>",
                        type:'POST',
                        dataType:"JSON",
                        async:false,
                        success:function(results){
                            if(results){
                                $('.cmttxt').val('');
                                $('.cmtdiv').remove();
                                cmtview();
                            }
                        }
                    });
                }else{
                    Swal.fire({
                        icon: 'warning',
                        title: '메모내용이 없습니다',
                        allowOutsideClick: false,
                    });
                }
            }
            if (window.event.keyCode == 13) {
                if($('.cmttxt').val()!=''){
                    $.ajax({
                        url:"/cmtinsert",
                        data:"company="+company+"&orderkey=<%=result[0].orderkey%>"+"&id="+uid+"&txt="+$('.cmttxt').val()+"&manager=<%=managername%>",
                        type:'POST',
                        dataType:"JSON",
                        async:false,
                        success:function(results){
                            if(results){
                                $(s).val('');
                                $('.cmtdiv').remove();
                                cmtview();
                            }
                        }
                    });
                }else{
                    Swal.fire({
                        icon: 'warning',
                        title: '메모내용이 없습니다',
                        allowOutsideClick: false,
                    });
                }
            }
        }

        function need_write(){
            Swal.fire({
                width: '48%',
                fontsize: '23px',
                didOpen: () => {
                    $( "#need_datepicker" ).datepicker({
                        changeMonth: true,
                        changeYear: true,
                        timeFormat:'HH:mm:ss',
                        dateFormat: 'yy-mm-dd',
                        controlType:'select',
                        oneLine:true,
                    });
                    $( "#need_datepicker" ).datepicker( "option", "showAnim", "slide" );
                    
                    let now = new Date();
                    let year= now.getFullYear();
                    let mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
                    let day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
                    let chan_val = year +'-'+ mon +'-'+ day;
                    axios({
                        method:'post',
                        url:'/needgetclient',
                        data:{
                            company:company,
                            number:'<%=result[0].number%>'
                        }
                    }).then(res=>{
                        const data = res.data.data;
                        $('.need_address').text(data[0].address);
                        $('.need_target').text(data[0].target);
                        $('.need_sex').text(data[0].sex);
                        $('.need_regident').text(data[0].regident);
                        const today = new Date();
                        const birthDate = new Date(data[0].regident);

                        let age = today.getFullYear() - birthDate.getFullYear();
                        const m = today.getMonth() - birthDate.getMonth();
                        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }
                        $('.need_age').text(age);
                        $('.need_phone').text(data[0].phone1);
                    });
                    $('.need_date').val(chan_val);
                    $('.need_writer').text('<%=managername%>');
                },
                title: '',
                html:
                `
                <div style="height:650px; overflow-y:scroll;">
                    <table class="tg">
                    <thead>
                        <tr>
                        <th class="tg-c3ow" colspan="4" rowspan="2" style="font-size:28px;">욕구사정 기록지</th>
                        <th class="tg-0pky">작성일</th>
                        <th class="tg-0pky need_date" colspan="2"><input type="text" readonly class="need_date" id="need_datepicker"></th>
                        </tr>
                        <tr>
                        <th class="tg-0pky">작성자</th>
                        <th class="tg-0pky" colspan="2"><div class="need_writer"></div>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;서명 또는 (인)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <td class="tg-0pky need_colum">수급자성명</td>
                        <td class="tg-0pky" colspan="2"><%=result[0].name%></td>
                        <td class="tg-0pky need_colum">키</td>
                        <td class="tg-0pky"><input type="text" class="need_height" style="width:40px; height:20px;">cm</td>
                        <td class="tg-0pky need_colum">생년월일</td>
                        <td class="tg-0pky need_regident"><%=result[0].regident%></td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum">인정번호/등급</td>
                        <td class="tg-0pky" colspan="2"><div class="flex"><%=result[0].number%>&nbsp;&nbsp;/&nbsp;&nbsp;<div class="need_target"></div></div></td>
                        <td class="tg-0pky need_colum">체중</td>
                        <td class="tg-0pky"><input type="text" class="need_weight" style="width:40px; height:20px;">kg</td>
                        <td class="tg-0pky need_colum">성별/연령</td>
                        <td class="tg-0pky "><div class="flex"><div class="need_sex"></div>&nbsp;&nbsp;/&nbsp;&nbsp;<div class="need_age">60</div></div></td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum">주소</td>
                        <td class="tg-0pky need_address" colspan="4"></td>
                        <td class="tg-0pky need_colum">전화번호</td>
                        <td class="tg-0pky need_phone"></td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum" colspan="7">1. 신체상태(일상생활 동작 수행능력)</td>
                        </tr>
                        <tr>
                        <td class="tg-0pky" colspan="7">
                            <textarea class="need_write_textarea need_body"></textarea>
                        </td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum" colspan="7">2. 인지상태(정신상태, 감정)</td>
                        </tr>
                        <tr>
                        <td class="tg-0pky" colspan="7">
                            <textarea class="need_write_textarea need_mental"></textarea>
                        </td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum" colspan="7">3. 가족 및 환경 상태</td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum">구분</td>
                        <td class="tg-0pky need_colum" colspan="6">확인</td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum">주수발자</td>
                        <td class="tg-0pky" colspan="2"><input type="checkbox" class="need_write_chkbox family_chkbox" value="y"> 유&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox family_chkbox" value="n"> 무</td>
                        <td class="tg-0pky need_colum" colspan="2">관계</td>
                        <td class="tg-0pky" colspan="2"><input type="text" class="need_guard_target" style="height:20px;"></td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum">자녀수</td>
                        <td class="tg-0pky" colspan="6"><input type="text" class="need_children_cnt" style="height:20px;"></td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum">동거인</td>
                        <td class="tg-0pky" colspan="6"><input type="checkbox" class="need_write_chkbox with_chkbox" value="0"> 독거&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="1">부부&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="2"> 부모&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="3"> 자녀&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="4"> 손자녀 <input type="checkbox" class="need_write_chkbox with_chkbox" value="5"> 친척&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="6"> 친구,이웃</td>
                        </tr>
                        <tr>
                        <td class="tg-0pky need_colum" colspan="7">4. 희망급여</td>
                        </tr>
                        <tr>
                            <td class="tg-0pky need_colum" colspan="3">보유중인 품목</td>
                            <td class="tg-0pky need_colum" colspan="4">희망 품목</td>
                        </tr>
                        <tr>
                            <td class="tg-0pky" colspan="3"><textarea class="need_write_textarea need_have_product"></textarea></td>
                            <td class="tg-0pky" colspan="4"><textarea class="need_write_textarea need_want_product"></textarea></td>
                        </tr>
                        <tr>
                        <td class="tg-0lax need_colum" colspan="7">5. 총평</td>
                        </tr>
                        <tr>
                        <td class="tg-0lax" colspan="7">
                            <textarea class="need_write_textarea need_result"></textarea>
                        </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
                `,
            //icon: 'info',
            showCancelButton: true,
            cancelButtonColor: '#d33',
            confirmButtonText: '작성',
            cancelButtonText: '취소',
            allowOutsideClick: false,
            
            }).then((result) => {
                if (result.isConfirmed) {
                    const need_date = $('.need_date').val();
                    const need_writer = '<%=managername%>';
                    const need_height = document.querySelector('.need_height').value;
                    const need_weight = document.querySelector('.need_weight').value;
                    const need_body = document.querySelector('.need_body').value;
                    const need_mental = document.querySelector('.need_mental').value;
                    let need_family_val = '';
                    $.each($('.family_chkbox'),function(i){
                        if ($('.family_chkbox').eq(i).is(":checked")) {
                            need_family_val = $('.family_chkbox').eq(i).val();
                        }
                    });
                    let need_with_live_val = '';
                    $.each($('.with_chkbox'),function(i){
                        if ($('.with_chkbox').eq(i).is(":checked")) {
                            need_with_live_val = $('.with_chkbox').eq(i).val();
                        }
                    });
                    const need_family = need_family_val;
                    const need_guard_target = document.querySelector('.need_guard_target').value;
                    const need_children_cnt = document.querySelector('.need_children_cnt').value;
                    const need_with_live = need_with_live_val;
                    const need_have_product = document.querySelector('.need_have_product').value;
                    const need_want_product = document.querySelector('.need_want_product').value;
                    const need_result = document.querySelector('.need_result').value;

                    axios({
                        method:'post',
                        url:'/need_save',
                        data:{
                            needdate:need_date,
                            needwriter:need_writer,
                            needheight:need_height,
                            needweight:need_weight,
                            needbody:need_body,
                            needmental:need_mental,
                            needfamily:need_family,
                            needguardtarget:need_guard_target,
                            needchildrencnt:need_children_cnt,
                            needwithlive:need_with_live,
                            needhaveproduct:need_have_product,
                            needwantproduct:need_want_product,
                            need_result:need_result,
                            company:company,
                            name:'<%=result[0].name%>',
                            number:'<%=result[0].number%>'
                        }
                    }).then(res=>{
                        const data = res.data;
                        if(data.code == 200){
                            Swal.fire(
                                '작성완료',
                                '',
                                'success'
                            ).then(result=>{
                                location.reload();
                            })
                        }else{
                            Swal.fire(
                                '작성실패',
                                '',
                                'error'
                            )
                        }
                    })
                }
            });
        }

        function need_get_data(){
            axios({
                method:'post',
                url:'/need_get_data',
                data:{
                    company:company,
                    name:'<%=result[0].name%>',
                    number:'<%=result[0].number%>'
                }
            }).then(res=>{
                const data = res.data;
                let str = '';
                if(data.code==200){
                    data.data.forEach(function(obj,index){
                        str += `
                        <div class="flex need_tr" onclick="need_get_data_click(${obj.num})"><div class="need_date">${obj.date.split(' ')[0]}</div><div class="need_result_txt">${obj.resulttext}</div></div>
                        `;
                    });
                    $('.need_th').after(str);
                }else{

                }
            })
        }

        function need_get_data_click(x){
            axios({
                method:'post',
                url:'/need_get_data_num',
                data:{
                    company:company,
                    name:'<%=result[0].name%>',
                    number:'<%=result[0].number%>',
                    key:x
                }
            }).then(res_data=>{
                const need_data = res_data.data;
                if(need_data.code==200){
                    Swal.fire({
                        width: '48%',
                        fontsize: '23px',
                        didOpen: () => {
                            $( "#need_datepicker_modify" ).datepicker({
                                changeMonth: true,
                                changeYear: true,
                                timeFormat:'HH:mm:ss',
                                dateFormat: 'yy-mm-dd',
                                controlType:'select',
                                oneLine:true,
                            });
                            $( "#need_datepicker_modify" ).datepicker( "option", "showAnim", "slide" );
                            
                            let now = new Date();
                            let year= now.getFullYear();
                            let mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
                            let day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
                            let chan_val = year +'-'+ mon +'-'+ day;
                            axios({
                                method:'post',
                                url:'/needgetclient',
                                data:{
                                    company:company,
                                    number:'<%=result[0].number%>'
                                }
                            }).then(res=>{
                                const data = res.data.data;
                                console.warn(data);
                                $('.need_address').text(data[0].address);
                                $('.need_target').text(data[0].target);
                                $('.need_sex').text(data[0].sex);
                                $('.need_regident').text(data[0].regident);
                                const today = new Date();
                                const birthDate = new Date(data[0].regident);

                                let age = today.getFullYear() - birthDate.getFullYear();
                                const m = today.getMonth() - birthDate.getMonth();
                                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                                    age--;
                                }
                                $('.need_age').text(age);
                                $('.need_phone').text(data[0].phone1);
                            });
                            $('#need_datepicker_modify').val(need_data.data[0].date.split(' ')[0]);

                            // $('.need_date').text(need_data.data[0].date.split(' ')[0]);
                            $('.need_writer').text(need_data.data[0].manager);
                            $('.need_height').val(need_data.data[0].cm);
                            $('.need_weight').val(need_data.data[0].kg);
                            $('.need_body').val(need_data.data[0].body);
                            $('.need_mental').val(need_data.data[0].mental);
                            $('.need_guard_target').val(need_data.data[0].familytarget);
                            $('.need_children_cnt').val(need_data.data[0].childrencnt);
                            $('.need_have_product').val(need_data.data[0].haveproduct);
                            $('.need_want_product').val(need_data.data[0].wantproduct);
                            $('.need_result').val(need_data.data[0].resulttext);
                            $('.family_chkbox').each(function(){
                                if(this.value==need_data.data[0].family){
                                    this.checked =true;
                                }
                            });
                            $('.with_chkbox').each(function(){
                                if(this.value==need_data.data[0].withlive){
                                    this.checked =true;
                                }
                            });
                        },
                        title: '',
                        html:
                        `
                        <div style="height:650px; overflow-y:scroll;">
                            <table class="tg">
                            <thead>
                                <tr>
                                <th class="tg-c3ow" colspan="4" rowspan="2" style="font-size:28px;">욕구사정 기록지</th>
                                <th class="tg-0pky">작성일</th>
                                <th class="tg-0pky need_date" colspan="2"><input type="text" readonly class="need_date" id="need_datepicker_modify"></th>
                                </tr>
                                <tr>
                                <th class="tg-0pky">작성자</th>
                                <th class="tg-0pky" colspan="2"><div class="need_writer"></div>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;서명 또는 (인)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                <td class="tg-0pky need_colum">수급자성명</td>
                                <td class="tg-0pky" colspan="2"><%=result[0].name%></td>
                                <td class="tg-0pky need_colum">키</td>
                                <td class="tg-0pky"><input type="text" class="need_height" style="width:40px; height:20px;">cm</td>
                                <td class="tg-0pky need_colum">생년월일</td>
                                <td class="tg-0pky need_regident"><%=result[0].regident%></td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum">인정번호/등급</td>
                                <td class="tg-0pky" colspan="2"><div class="flex"><%=result[0].number%>&nbsp;&nbsp;/&nbsp;&nbsp;<div class="need_target"></div></div></td>
                                <td class="tg-0pky need_colum">체중</td>
                                <td class="tg-0pky"><input type="text" class="need_weight" style="width:40px; height:20px;">kg</td>
                                <td class="tg-0pky need_colum">성별/연령</td>
                                <td class="tg-0pky "><div class="flex"><div class="need_sex"></div>&nbsp;&nbsp;/&nbsp;&nbsp;<div class="need_age">60</div></div></td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum">주소</td>
                                <td class="tg-0pky need_address" colspan="4"></td>
                                <td class="tg-0pky need_colum">전화번호</td>
                                <td class="tg-0pky need_phone"></td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum" colspan="7">1. 신체상태(일상생활 동작 수행능력)</td>
                                </tr>
                                <tr>
                                <td class="tg-0pky" colspan="7">
                                    <textarea class="need_write_textarea need_body"></textarea>
                                </td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum" colspan="7">2. 인지상태(정신상태, 감정)</td>
                                </tr>
                                <tr>
                                <td class="tg-0pky" colspan="7">
                                    <textarea class="need_write_textarea need_mental"></textarea>
                                </td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum" colspan="7">3. 가족 및 환경 상태</td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum">구분</td>
                                <td class="tg-0pky need_colum" colspan="6">확인</td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum">주수발자</td>
                                <td class="tg-0pky" colspan="2"><input type="checkbox" class="need_write_chkbox family_chkbox" value="y"> 유&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox family_chkbox" value="n"> 무</td>
                                <td class="tg-0pky need_colum" colspan="2">관계</td>
                                <td class="tg-0pky" colspan="2"><input type="text" class="need_guard_target" style="height:20px;"></td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum">자녀수</td>
                                <td class="tg-0pky" colspan="6"><input type="text" class="need_children_cnt" style="height:20px;"></td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum">동거인</td>
                                <td class="tg-0pky" colspan="6"><input type="checkbox" class="need_write_chkbox with_chkbox" value="0"> 독거&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="1">부부&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="2"> 부모&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="3"> 자녀&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="4"> 손자녀 <input type="checkbox" class="need_write_chkbox with_chkbox" value="5"> 친척&nbsp;&nbsp;<input type="checkbox" class="need_write_chkbox with_chkbox" value="6"> 친구,이웃</td>
                                </tr>
                                <tr>
                                <td class="tg-0pky need_colum" colspan="7">4. 희망급여</td>
                                </tr>
                                <tr>
                                    <td class="tg-0pky need_colum" colspan="3">보유중인 품목</td>
                                    <td class="tg-0pky need_colum" colspan="4">희망 품목</td>
                                </tr>
                                <tr>
                                    <td class="tg-0pky" colspan="3"><textarea class="need_write_textarea need_have_product"></textarea></td>
                                    <td class="tg-0pky" colspan="4"><textarea class="need_write_textarea need_want_product"></textarea></td>
                                </tr>
                                <tr>
                                <td class="tg-0lax need_colum" colspan="7">5. 총평</td>
                                </tr>
                                <tr>
                                <td class="tg-0lax" colspan="7">
                                    <textarea class="need_write_textarea need_result"></textarea>
                                </td>
                                </tr>
                            </tbody>
                            </table>
                        </div>
                        `,
                    //icon: 'info',
                    showCancelButton: true,
                    cancelButtonColor: '#d33',
                    confirmButtonText: '수정',
                    cancelButtonText: '취소',
                    allowOutsideClick: false,
                    
                    }).then((result) => {
                        if (result.isConfirmed) {
                            const need_date = $('#need_datepicker_modify').val();
                            const need_writer = '<%=managername%>';
                            const need_height = document.querySelector('.need_height').value;
                            const need_weight = document.querySelector('.need_weight').value;
                            const need_body = document.querySelector('.need_body').value;
                            const need_mental = document.querySelector('.need_mental').value;
                            let need_family_val = '';
                            $.each($('.family_chkbox'),function(i){
                                if ($('.family_chkbox').eq(i).is(":checked")) {
                                    need_family_val = $('.family_chkbox').eq(i).val();
                                }
                            });
                            let need_with_live_val = '';
                            $.each($('.with_chkbox'),function(i){
                                if ($('.with_chkbox').eq(i).is(":checked")) {
                                    need_with_live_val = $('.with_chkbox').eq(i).val();
                                }
                            });
                            const need_family = need_family_val;
                            const need_guard_target = document.querySelector('.need_guard_target').value;
                            const need_children_cnt = document.querySelector('.need_children_cnt').value;
                            const need_with_live = need_with_live_val;
                            const need_have_product = document.querySelector('.need_have_product').value;
                            const need_want_product = document.querySelector('.need_want_product').value;
                            const need_result = document.querySelector('.need_result').value;

                            axios({
                                method:'post',
                                url:'/need_modify',
                                data:{
                                    needdate:need_date,
                                    needwriter:'<%=managername%>',
                                    needheight:need_height,
                                    needweight:need_weight,
                                    needbody:need_body,
                                    needmental:need_mental,
                                    needfamily:need_family,
                                    needguardtarget:need_guard_target,
                                    needchildrencnt:need_children_cnt,
                                    needwithlive:need_with_live,
                                    needhaveproduct:need_have_product,
                                    needwantproduct:need_want_product,
                                    need_result:need_result,
                                    company:company,
                                    name:'<%=result[0].name%>',
                                    number:'<%=result[0].number%>',
                                    key:x
                                }
                            }).then(res=>{
                                const data = res.data;
                                if(data.code == 200){
                                    Swal.fire(
                                        '수정완료',
                                        '',
                                        'success'
                                    ).then((result) => {
                                        location.reload();
                                    });
                                }else{
                                    Swal.fire(
                                        '수정실패',
                                        '',
                                        'error'
                                    )
                                }
                            })
                        }
                    });
                }
                
            })
        }

        async function rentmodify_cms_rent_chk(){
            return axios({
                method:"post",
                url:"/RentModifyCmsRentChk",
                data:{
                    company:company,
                    key:key,
                }
            }).then(res=>{
                let data = res.data;
                return data;
            });
        }

        async function rentmodify_cms_memeber_chk(){
            return axios({
                method:"post",
                url:"/RentModifyCmsMemeberChk",
                data:{
                    company:company,
                    key:key,
                    name:"<%=result[0].name%>",
                    number:"<%=result[0].number%>"
                }
            }).then(res=>{
                let data = res.data;
                return data;
            });
        }

        function cms_chk_area(control){
            let str = `
            <div style="color:#000; font-weight:bold;">CMS 미등록</div>
            `;
            if(control==1){
                $('.switch-contents').hide();
                $('.cms_chk_area').append(str);
            }
        }

        async function cms_state_change(control){
            return axios({
                method:"post",
                url:"/RentModifyCmsStateChange",
                data:{
                    company:company,
                    key:key,
                    control:control
                }
            }).then(res=>{
                let data = res.data;
                return data;
            });
        }

        function toggleSwitch(control) {
            var checkbox = document.getElementById("mySwitch");
            var slider = checkbox.nextElementSibling;
            var onLabel = $('.switch-on');
            var offLabel = $('.switch-off');
            if (checkbox.checked || control==0) {
                slider.style.backgroundColor = "#ccc";
                $('.switch-txt').text("중지");
                checkbox.checked = false;
                if(control!=0){
                    cms_state_change(0).then(res=>{
                        console.warn(res);
                        if(res.code==200){
                            slider.style.backgroundColor = "#ccc";
                            $('.switch-txt').text("중지");
                            checkbox.checked = false;
                            Swal.fire("중지완료","","success");
                        }
                    });
                }
            } else if (!checkbox.checked || control==1) {
                slider.style.backgroundColor = "rgb(91, 179, 89)";
                $('.switch-txt').text("정상");
                checkbox.checked = true;
                if(control!=1){
                    cms_state_change(1).then(res=>{
                        console.warn(res);
                        if(res.code==200){
                            slider.style.backgroundColor = "rgb(91, 179, 89)";
                            $('.switch-txt').text("정상");
                            checkbox.checked = true;
                            Swal.fire("정상처리완료","","success");
                        }
                    });
                }
                
            }
        }

    function moveorder(){
        location.href="//xn--9o7b95g.com/ordermodify/1/"+uid+"/<%=result[0].number%>/"+orderkey;
    }
        
    </script>
    
    <a style="display:none;" class="btn" data-popup-open="popup-1" href="#">Open Popup #1</a>
    <a style="display:none;" class="btn" data-popup-open2="popup-2" href="#">Open Popup #1</a>
    <a style="display:none;" class="btn" data-popup-open4="popup-4" href="#">Open Popup #1</a>
    
    <div class="background">
        <div class="maincontainer">
            <div>
                <div class="order_move_button" onclick="moveorder()">&#9664; 주문/발주서 이동</div>
            </div>
            <div class="title">
                <div>
                    <span class="material-icons flex">manage_accounts</span><span>대여 정보</span>
                </div>
            </div>
            <table class="statetable">
                <tr>
                    <td colspan="1">주문일자</td>
                    <td>
                        <input id="datepicker" class="w150" type="text" disabled>
                    </td>
                    <td colspan="1">CMS출금상태</td>
                    <td class="flex cms_chk_area" style="position:relative;">
                        
                            <label class="switch-container switch-contents" onclick="toggleSwitch()">
                                <input type="checkbox" class="switch-input" id="mySwitch">
                                <span class="switch-slider"></span>
                            </label>
                            <div class="switch-txt switch-contents" style="position:absolute; cursor:pointer; color:#fff;" onclick="toggleSwitch()"></div>
                        
                    </td>
                </tr>
                <tr class="rentdate">
                    <td colspan="1">현재 유효기간</td><td><input id="" class="w150" type="text" value="<%=client[0].rcgt ? client[0].rcgt.split('~')[0].replace(/-/g,'').replace(/ /g,'') : '재조회'%>"><input class="w150" id="" type="text" value="<%=client[0].rcgt ? client[0].rcgt.split('~')[1].replace(/-/g,'').replace(/ /g,'') : '재조회'%>"></td>
                </tr>
                <tr class="rentdate">
                    <td colspan="1">현재 적용구간</td><td><input id="datepicker2" class="rentdatestart w150" type="text"><input class="rentdateend w150" id="datepicker3" type="text"></td><td colspan="1">다음 적용구간</td><td><input class="rentdatenextstart w150" id="datepicker3" type="text"><input class="rentdatenextend w150" id="datepicker3" type="text"></td>
                </tr>
                <tr>
                    <td>수급자성함</td><td><input class="name w150" type="text" value="<%=client[0].name%>"></td><td>인정번호</td><td><input class="number w150" type="text" value="<%=client[0].number%>" placeholder="요양인정번호 10자리" ></td>
                </tr>
                <tr>
                    <td>생년월일</td><td><input class="regident w150" type="text" value="<%=client[0].regident%>" placeholder="예시: 630321"></td><td>등 급</td><td><input class="ranker w150" value="<%=client[0].ranker%>" type="text" placeholder="예시: 5등급"></td>
                </tr>
                <tr>
                    <td>대 상</td><td><input class="target w150" type="text" value="<%=client[0].target%>" placeholder="예시: 일반"></td><td>본인부담율</td><td><select class="sale w150" style="height:30px;"></select>
                </tr>
                <tr>
                    <td>배송주소</td>
                    <td rowspan="1">    
                        <input class="material-icons" style="display:none;" type="button" onclick="sample3_execDaumPostcode()" value="주소 검색 saved_search"><br>
                        <input class="addressnum w150" type="text" id="sample3_postcode" value="<%=client[0].addressnum%>" placeholder="우편번호">
                    </td>
                    <td colspan="2" style="background: #fff;">
                        <input style="margin-bottom: 5px;" class="address1 w280" type="text" id="sample3_address" value="<%=client[0].address%>" placeholder="주소"><br>
                        <input class="address1_2 w280" type="text" id="sample3_detailAddress" value="<%=client[0].addressdetail%>" placeholder="상세주소">
                        <input style="display:none;" type="text" id="sample3_extraAddress" placeholder="참고항목">
                    </td>
                </tr>
                <tr>
                    <td>보호자성함</td><td><input class="guardname w150" type="text" value="<%=result[0].guardname%>"></td><td>수급자관계</td><td><input class="guardtarget w150" type="text" value="<%=result[0].guardtarget%>"></td>
                </tr>
                <tr>
                    <td>연락처1</td><td><input class="phone1 w150" type="text" value="<%=client[0].phone1%>"></td><td>연락처2</td><td><input class="phone2 w150" type="text" value="<%=client[0].phone2%>"></td>
                </tr>
                <tr>
                    <td>센터명</td><td><input class="centername w150" type="text" value="<%=client[0].centername%>"></td>
                    <td>담당자</td><td>
                        <select class="manager" style="height:30px;">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>배송/물류 담당자</td><td>
                        <select class="deliverymanager" style="height:30px;">
                        </select>
                    </td>
                    <td>배송상태</td><td>
                        <select class="state" style="height:30px;">
                        </select>
                    </td>
                </tr>
                
            </table>
            <div class="flexcolc need_area mobile">
                <div class="flex" style="height:50px; background: #1a2136; color:#fff; border-radius: 5px;"><div>욕구사정기록 내역</div><div class="need_write_btn" onclick="need_write();">기록 추가/작성하기</div></div>
                <div class="flex need_th"><div class="need_date_th">작성일</div><div class="need_result_txt">총평</div></div>
                <!-- <table>
                    <thead>
                        <tr>
                            <th>날짜</th><th>총평</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2024-01-01</td><td>거동이 불편하여 침대를 필요로 하심</td>
                        </tr>
                    </tbody>
                </table> -->
            </div>
            <!-- <div style="width:100%; text-align: center;" class="signbox">
                <canvas id="signature" width="200" height="200"></canvas>
                <div style="width:100%; text-align: center;">
                    <button style="display:none;" id="save">Save</button>
                    <button id="clear">지우기</button>
                </div>
            </div> -->
            <!--div class="signbox">
                <div style="width:300px; height:300px;">
                <canvas id="canvas" style="border:1px solid black"></canvas>
                </div>
                <div>
                
                <button id="save">save</button>
            </div-->
        </div>
        
        <style>
            .maincontainer-2{
                display:flex;
                justify-content: center;
                align-items: center;
                width:3%;
                height:700px;
                /*background:linear-gradient( 45deg, #ffffff, #ffffff, #ffffff );*/
                color:#ffffff;
            }
            /*
            .maincontainer-2:hover{
                border:1px solid #b4b4b4;
                border-radius: 5px;
                cursor:pointer;
            }
            */
            iframe{
                width:100%;
                height:100%;
            }
            
        </style>
        
        <div class="mobile maincontainer-2">
            <span style="display:none;" class="material-icons">navigate_next</span>
        </div>
        
        <script>
            $(document).ready(function(){
                $('.pdftable').fadeIn();
                $('.maincontainer-2 span').eq(0).html('navigate_before');
                    //$('.popup-inner', parent.document).css("max-width","1700px");
                    //$('.popup-inner', parent.document).css("width","1700px");
                    //$('.popup2-inner', parent.document).css("max-width","1700px");
                    //$('.popup2-inner', parent.document).css("width","1700px");
                    /*
                $('.maincontainer-2').click(function(){
                    $('.pdftable').animate({
                        width:"toggle"
                    },200);
                    
                    $('.maincontainer-2 span').eq(0).html('navigate_before');
                    $('.popup-inner', parent.document).css("max-width","1700px");
                    $('.popup-inner', parent.document).css("width","1700px");
                });
                */
            });
        </script>
        
        <style>
            
        </style>
        
        <script>
            var mstr = '<span style="font-size:12px; font-weight:bold; color:#0a6b22;">자동저장완료</span><span class="material-icons" style="font-size:15px; font-weight:bold; color:#0a6b22;">done</span>';
            function automemo(){
                $('.memoautosave').children().remove();
                $('.memoautosave').append(mstr);
                $.ajax({
                    type: 'POST',
                    url: '/rentmemo',
                    data: "company="+company+"&renttxtarea="+$('.renttxtarea').val()+"&key="+key,
                    dataType: "JSON", 
                    success: function (data) {
                    }
                });
            }

            function automemo2(){
                $.ajax({
                type: 'POST',
                url: '/rentmemo2',
                data: "company="+company+"&key="+key,
                dataType: "JSON", 
                success: function (data) {
                    $('.renttxtarea').val(data.result[0].wantmemo);
                    }
                });
            }
            automemo2();

            function date_now(){
                var now = new Date();
                var year= now.getFullYear();
                var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
                var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
                var time = now.getHours()+':'+now.getMinutes()+':'+now.getSeconds();
                var chan_val = year+'-'+mon+'-'+day;
                return chan_val
            }

            function relookup(){
                swal.fire({
                    width: '450px',
                    fontsize: '23px',
                    title: '재조회하시겠습니까?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '확인',
                    cancelButtonText: '취소',
                    allowOutsideClick: false,
                }).then((result) => {
                    if (result.isConfirmed) {
                        $('.maincontainer-3').hide();
                        $('.reloading').show();
                        socket.emit('disconnect2', {'name': uid});
                        socket.emit('login', {'name': uid});
                        // socket.emit('message', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>'});
                        socket.emit('go_lookup_req', { 'name':uid, 'cname':'<%=result[0].name%>', 'cnumber':'<%=result[0].number%>', 'agent':'' , 'target':'', 'company':company, 'date':date_now().replace(/-/g,'') });
                        $('.relookup').fadeOut();
                        $('.relookup2').fadeIn();
                    }
                });
            }
        </script>
        
        <div class="reloading" style="">
            <div class="loading">
                <div class="sk-folding-cube">
                    <div class="sk-cube1 sk-cube"></div>
                    <div class="sk-cube2 sk-cube"></div>
                    <div class="sk-cube4 sk-cube"></div>
                    <div class="sk-cube3 sk-cube"></div>
                </div>
            </div>
        </div>
        
        <div style="display:none; width:100%;" class="pdftable maincontainer-3">
            <div class="maincontainer-3title material-icons"><span>drive_file_rename_outline</span>&nbsp;&nbsp;&nbsp;<span>메 모</span>&nbsp;&nbsp;&nbsp;<div class="memoautosave"></div></div>
            <div class="flexcolumns">
                <div class="flex"><textarea class="cmttxt" style="height:25px;" onkeyup="centerkey(this)"></textarea><div class="cmtbtn btn flex" onclick="centerkey(1)">입력</div></div>
                <div class="cmtbox flexcolumns"></div>
            </div>
            <%
            var rentchk = '대여중';
            var scolor = 'sgreen';
            if(result[0].rentchk=="y"){ rentchk = '대여중'; scolor = "sgreen";}else if(result[0].rentchk=="n"){ rentchk = '회수'; scolor = "sred";}else if(result[0].rentchk=='s'){ rentchk = '중지'; scolor = "sorange";}%>
            <div class="maincontainer-3title"><span class="material-icons">category</span>&nbsp;&nbsp;&nbsp;<span>현재 대여 내역</span>&nbsp;&nbsp;[<span class="<%=scolor%>" style="font-weight:bold; font-size:20px;">&nbsp;<%=rentchk%>&nbsp;</span><span class="rentstoptxt"></span>]</div>
            <!--div>* 비급여건 계약일은 주문서 수정</div--> <%if(result[0].status=='back' || result[0].status=='backend'){%><div style="margin:10px;">회수요청일 : <%=result[0].cancled.split(' ')[0]%></div><%}%>
            <table>
                <tbody class="productload">
                    <tr>
                        <td class="mobile" style="width:7%;">품목코드</td>
                        <td style="width:18%;">바코드</td>
                        <td class="mobile" style="width:12%;">품목</td>
                        <td style="width:10%;">품목명</td>
                        <td style="width:10%;">계약시작</td>
                        <td style="width:10%;">계약종료</td>
                        <td class="mobile" style="width:11%;">단가</td>
                        <td class="mobile" style="width:8%;">본인부담금</td>
                        <td class="mobile" style="width:8%;">공단부담금</td>
                        <td class="mobile" style="width:10%;">비급여처리</td>
                    </tr>
                </tbody>
            </table>
            <table class="totaltable">
                <tbody>
                    <tr>
                        <td style="width:7%;"></td>
                        <td style="width:18%;"></td>
                        <td style="width:12%;">합계</td>
                        <td style="width:10%;"></td>
                        <td style="width:10%;"></td>
                        <td style="width:10%;"></td>
                        <td class="buypricetotaldan" style="width:11%;"></td>
                        <td class="buypricetotal mobile" style="width:8%;"></td>
                        <td class="buypricetotalgong mobile"style="width:8%;"></td>
                        <td style="width:10%;"></td>
                    </tr>
                </tbody>
            </table>
            <div style="display:none;" class="deletebutton">
                <span></span>
            </div>
            <div style="display:none;" class="material-icons addbox buzz-out-on-hover"><span>add_box</span></div>
            <div class="maincontainer-3title material-icons"><span>playlist_add</span>&nbsp;&nbsp;&nbsp;<span>대여계약 가능 적용구간</span><div class="nxdrelookup" style="display: flex;"><span class='relookup' onclick='relookup();' style="font-size:14px;">재조회</span><span class="relookup2" style="display: none; padding-top:5px;">재조회중입니다...</span></div></div>
            <table>
                <tbody class="productload2">
                    <tr>
                        <td colspan=2 style="width:4%;">상태</td>
                        <td style="width:12%;">품목</td>
                        <td style="width:10%;">품목명</td>
                        <td style="width:10%;">계약시작</td>
                        <td style="width:10%;">계약종료</td>
                        <td style="width:5%;"></td>
                    </tr>
                </tbody>
            </table>
            <table class="totaltable" style="display:none;">
                <tbody>
                    <tr>
                        <td></td>
                        <td style="width:7%;"></td>
                        <td style="width:18%;"></td>
                        <td style="width:12%;">합계</td>
                        <td style="width:10%;"></td>
                        <td style="width:10%;"></td>
                        <td style="width:10%;"></td>
                        <td style="width:10%;"></td>
                    </tr>
                </tbody>
            </table>
            
        </div>
    </div>

    <script>
    
        function printiframedata(x){
            $('iframe[name="print1"]').contents().find('.name').html('<%=result[0].name%>');
            $('iframe[name="print1"]').contents().find('.regident').html('<%=result[0].regident%>');
            $('iframe[name="print1"]').contents().find('.number').html('<%=result[0].number%>');
            $('iframe[name="print1"]').contents().find('.target').html('<%=result[0].target%><%=result[0].sale%>');
            $('iframe[name="print1"]').contents().find('.ranker').html('<%=result[0].ranker%>');
            $('iframe[name="print1"]').contents().find('.address').html('<%=result[0].address%>&nbsp;&nbsp;<%=result[0].addressdetail%>');
            $('iframe[name="print1"]').contents().find('.pdfguardname').html('<%=result[0].guardname%>');
            $('iframe[name="print1"]').contents().find('.pdfguardtarget').html('<%=result[0].guardtarget%>');
            $('iframe[name="print1"]').contents().find('.pdfphone1').html('<%=result[0].phone%>');
            $('iframe[name="print1"]').contents().find('.pdfrequestmemo').html('<%=result[0].reqeustmemo%>');
            $('iframe[name="print1"]').contents().find('.company').html('<%=company%>');
            $('iframe[name="print1"]').contents().find('.ceo').html('<%=articles.contents[0].ceo%>');
            $('iframe[name="print1"]').contents().find('.companynum').html('<%=companynum%>');
            $('iframe[name="print1"]').contents().find('.sale').html('<%=result[0].sale%>');
            $('iframe[name="print1"]').contents().find('.sdate').html('<%=result[0].orderdate.split(" ")[0]%>');
            var now = new Date();
            var year= now.getFullYear();
            var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
            var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
            var chan_val = year +'/'+ mon +'/'+ day;
            function getTodayLabel() {
                var week = new Array('(일)', '(월)', '(화)', '(수)', '(목)', '(금)', '(토)');
                var today = new Date().getDay();
                var todayLabel = week[today];

                return todayLabel;
            }

            $('iframe[name="print1"]').contents().find('.pdfday').html(chan_val+getTodayLabel());
            var pdfstr1 = '';
            var pdfstr2 = '';
            var pdfdan = 0;
            var pdfbuy = 0;
            var pdfgong = 0;
            var pdfbuycnt = 0;
            var pdfdantotal = 0;
            var pdfbuytotal = 0;
            var pdfgongtotal = 0;
            var targetclass="rentcls";
            $.each($('.pdfname'),function(i){
                pdfbuycnt += parseInt($('.buycnt').eq(i).val());
                pdfdan = $('.buypricedan').eq(i).text().replace('원','');
                pdfdantotal += parseInt(pdfdan);
                pdfbuy = $('.buyprice').eq(i).text().replace('원','');
                pdfbuytotal += parseInt(pdfbuy);
                pdfgong = $('.buypricegong').eq(i).text().replace('원','');
                pdfgongtotal += parseInt(pdfgong);
                if(x=="rent2"){
                    $('.popup4-inner').css({"width":"1400px"});
                    pdfstr1 += "<tr class='addpdf' height=47 style='mso-height-source:userset;height:35.25pt'><td colspan=3 height=47 class='xl368' style='border-right:1.0pt solid black; border-top:none;'>"+$('.'+targetclass+' .pdfname').eq(i).text()+"</td><td class='xl368' style='border-right:1.0pt solid black;border-top:none;border-left:none'>"+$('.'+targetclass+' .pdfname2').eq(i).text()+"</td><td class='xl368' style='border-right:1.0pt solid black;border-top:none;border-left:none'>"+$('.'+targetclass+' .pdfcode').eq(i).text()+"</td><td colspan=2 class='xl368' width=171 style='border-right:1.0pt solid black;border-top:none;border-left:none'>"+$('.'+targetclass+' .bcodeinput').eq(i).val()+"</td><td class='xl368' style='border-right:1.0pt solid black;border-top:none;border-left:none'>"+$('.gongstarttxt').eq(i).val()+"</td><td class='xl368' style='border-right:1.0pt solid black;border-top:none;border-left:none'>~</td><td class='xl368' style='border-right:1.0pt solid black;border-top:none;border-left:none'>"+$('.gongendtxt').eq(i).val()+"</td><td class='xl368' style='border-right:1.0pt solid black;border-top:none;border-left:none'>"+parseInt(pdfdan).toLocaleString()+"원</td><td class='xl368 sdate' style='border-right:1.0pt solid black;border-right:1.0pt solid black;border-top:none;border-left:none'>"+parseInt(pdfbuy).toLocaleString()+"원</td></tr>";
                }
                if(x=="rent")pdfstr1 += "<tr class='addpdf' height=53 style='mso-height-source:userset;height:39.95pt'><td height=53 class='xl118 pdfname' style='height:39.95pt; border-left:1.0pt solid black; border-right:1.0pt solid black;'>"+$('.pdfname').eq(i).text()+"</td><td class='xl118 borderstyle' width=149 style='width:112pt;'>"+$('.pdfname2').eq(i).text()+"</td><td class='xl118 borderstyle'>"+$('.pdfcode').eq(i).text()+"</td><td class='xl118 borderstyle' style=''>"+parseInt(pdfdan).toLocaleString()+"</td><td class='xl118 borderstyle'>"+parseInt(pdfbuy).toLocaleString()+"</td><td class='xl118 borderstyle'>"+parseInt(pdfgong).toLocaleString()+"</td><td colspan=2 class='xl118 borderstyle'>"+$('.gongstarttxt').eq(i).val()+"~"+$('.gongendtxt').eq(i).val()+"</td></tr>";
            });
            $('iframe[name="print1"]').contents().find('.pdfadd2').nextAll('.addpdf').remove();
            $('iframe[name="print1"]').contents().find('.pdfadd2').after(pdfstr1);
            $('iframe[name="print1"]').contents().find('.pdfbuycnt').html(pdfbuycnt.toLocaleString());
            $('iframe[name="print1"]').contents().find('.pdfdantotal2').html(pdfdantotal.toLocaleString());
            $('iframe[name="print1"]').contents().find('.pdfbuytotal2').html(pdfbuytotal.toLocaleString());
            $('iframe[name="print1"]').contents().find('.pdfgongtotal').html(pdfgongtotal.toLocaleString());
            pdfstr2 = '<span style="position: absolute; left:50px; top:-25px;"><image style="width:110px;" src="/img/sign/image_<%=company%>_<%=result[0].number%>.png" onerror="this.style.display=\'none\'"></span>';
            pdfstr3 = '<span style="position: absolute; left:0px; top:0px;"><image style="width:60px;" src="/img/companystamp/<%=result[0].company%>.jpg" onerror="this.style.display=\'none\'"></span>';
            $('iframe[name="print1"]').contents().find('.pdfsign').children('span').remove();
            $('iframe[name="print1"]').contents().find('.pdfsign').append(pdfstr2);
            $('iframe[name="print1"]').contents().find('.pdfsign2').append(pdfstr3);
        }

        function printiframe(){
                var targeted_popup_class = $('[data-popup-open4]').attr('data-popup-open4');
                $('[data-popup4="' + targeted_popup_class + '"]').fadeIn(350);
                printiframedata('rent');
        }

    </script>

    <div class="footer">
        <div>
            <% if(result[0].rentchk!='s'){%>
            <div class="fbutton1">
                <div class="flex footerbutton1 ok" onclick="confirmchk('y');"><span>공단계약하기</span><span class="material-icons" style="color:rgb(81, 187, 67)">dvr</span></div><div class="alert1 flex"><span class="material-icons">fmd_bad</span><span>공단미계약 대여건입니다.</span></div>
            </div>
            <% } %>
            <div class="">
                <div class="flex footerbutton1 m" onclick="confirmchk('m');"><span>공단계약수정</span><span class="material-icons" style="color:rgb(67, 95, 187)">dvr</span></div>
            </div>
            <div>
                <div class="flex footerbutton1 n" onclick="confirmchk('n');"><span>공단계약취소</span><span class="material-icons" style="color:rgb(187, 67, 67)">dvr</span></div>
            </div>
            <div>
                <div class="flex footerbutton1 n" onclick="confirmchk('z');"><span>공단계약연장</span><span class="material-icons" style="color:rgb(228, 136, 31)">dvr</span></div>
            </div>
            <!--div>
                <div class="flex footerbutton1" onclick="printiframe();"><span class="print1">계약서출력</span><span class="material-icons" style="color:rgb(67, 109, 187)">print</span></div>
            </div-->
            <div>
                <div class="flex footerbutton1" style="display:none;"><span>CMS 출력</span><span class="material-icons" style="color:rgb(67, 149, 187)">print</span></div>
            </div>
        </div>
        <div class="back" id="submit" onclick="submitorder('back');">
            <span class="material-icons">not_accessible</span>&nbsp;&nbsp;<span class="renttxt">회수 등록</span>
        </div>
        <% if((result[0].number)){%>
            <% if(result[0].rentchk=='y'){%>
        <div class="back" id="submit3" onclick="submitorder('stop');">
            <span class="material-icons">pause</span>&nbsp;&nbsp;<span class="renttxt">대여 중지</span>
        </div>
            <% }else if(result[0].rentchk=='s'){%>
                <div class="back" id="submit4" onclick="submitorder('stopr');">
                    <span class="material-icons">restart_alt</span>&nbsp;&nbsp;<span class="renttxt">대여 재시작</span>
                </div>
        <div class="back" id="submit4" onclick="submitorder('stopc');">
            <span class="material-icons">close</span>&nbsp;&nbsp;<span class="renttxt">대여 중지 취소</span>
        </div>
            <% } %>
        <% } %>
        <div class="backcancle" id="submit2" onclick="submitorder('backcancle');">
            <span class="material-icons">not_accessible</span>&nbsp;&nbsp;<span class="renttxt">회수 취소</span>
        </div>
    </div>

    <div id="layer" style="display:none;position:fixed;overflow:hidden;z-index:1;-webkit-overflow-scrolling:touch;">
        <img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnCloseLayer" style="cursor:pointer;position:absolute;right:-3px;top:-3px;z-index:1" onclick="closeDaumPostcode()" alt="닫기 버튼">
    </div>
    
    <script>
        // 우편번호 찾기 화면을 넣을 element
        var element_layer = document.getElementById('layer');

        function closeDaumPostcode() {
            // iframe을 넣은 element를 안보이게 한다.
            element_layer.style.display = 'none';
        }

        function sample2_execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                    // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                    // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                    var addr = ''; // 주소 변수
                    var extraAddr = ''; // 참고항목 변수

                    //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                    if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                        addr = data.roadAddress;
                    } else { // 사용자가 지번 주소를 선택했을 경우(J)
                        addr = data.jibunAddress;
                    }

                    // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                    if(data.userSelectedType === 'R'){
                        // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                        // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                        if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                            extraAddr += data.bname;
                        }
                        // 건물명이 있고, 공동주택일 경우 추가한다.
                        if(data.buildingName !== '' && data.apartment === 'Y'){
                            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                        }
                        // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                        if(extraAddr !== ''){
                            extraAddr = ' (' + extraAddr + ')';
                        }
                        // 조합된 참고항목을 해당 필드에 넣는다.
                        document.getElementById("sample2_extraAddress").value = extraAddr;
                        //if(document.getElementById("addresschk").checked) document.getElementById("sample3_extraAddress").value = extraAddr;
                    } else {
                        document.getElementById("sample2_extraAddress").value = '';
                    }

                    // 우편번호와 주소 정보를 해당 필드에 넣는다.
                    document.getElementById('sample2_postcode').value = data.zonecode;
                    if(document.getElementById("addresschk").checked) document.getElementById("sample3_postcode").value = data.zonecode;
                    document.getElementById("sample2_address").value = addr;
                    if(document.getElementById("addresschk").checked) document.getElementById("sample3_address").value = addr;
                    // 커서를 상세주소 필드로 이동한다.
                    document.getElementById("sample2_detailAddress").focus();
                    if(document.getElementById("addresschk").checked) document.getElementById("sample3_detailAddress").focus();

                    // iframe을 넣은 element를 안보이게 한다.
                    // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
                    element_layer.style.display = 'none';
                },
                width : '100%',
                height : '100%',
                maxSuggestItems : 5
            }).embed(element_layer);

            // iframe을 넣은 element를 보이게 한다.
            element_layer.style.display = 'block';

            // iframe을 넣은 element의 위치를 화면의 가운데로 이동시킨다.
            initLayerPosition();
        }

        // 브라우저의 크기 변경에 따라 레이어를 가운데로 이동시키고자 하실때에는
        // resize이벤트나, orientationchange이벤트를 이용하여 값이 변경될때마다 아래 함수를 실행 시켜 주시거나,
        // 직접 element_layer의 top,left값을 수정해 주시면 됩니다.
        function initLayerPosition(){
            var width = 300; //우편번호서비스가 들어갈 element의 width
            var height = 400; //우편번호서비스가 들어갈 element의 height
            var borderWidth = 5; //샘플에서 사용하는 border의 두께

            // 위에서 선언한 값들을 실제 element에 넣는다.
            element_layer.style.width = width + 'px';
            element_layer.style.height = height + 'px';
            element_layer.style.border = borderWidth + 'px solid';
            // 실행되는 순간의 화면 너비와 높이 값을 가져와서 중앙에 뜰 수 있도록 위치를 계산한다.
            element_layer.style.left = (((window.innerWidth || document.documentElement.clientWidth) - width)/2 - borderWidth) + 'px';
            element_layer.style.top = (((window.innerHeight || document.documentElement.clientHeight) - height)/2 - borderWidth) + 'px';
        }
    </script>
            
    <script>
        // 우편번호 찾기 화면을 넣을 element
        var element_layer = document.getElementById('layer');

        function closeDaumPostcode() {
            // iframe을 넣은 element를 안보이게 한다.
            element_layer.style.display = 'none';
        }

        function sample3_execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                    // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                    // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                    var addr = ''; // 주소 변수
                    var extraAddr = ''; // 참고항목 변수

                    //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                    if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                        addr = data.roadAddress;
                    } else { // 사용자가 지번 주소를 선택했을 경우(J)
                        addr = data.jibunAddress;
                    }

                    // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                    if(data.userSelectedType === 'R'){
                        // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                        // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                        if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                            extraAddr += data.bname;
                        }
                        // 건물명이 있고, 공동주택일 경우 추가한다.
                        if(data.buildingName !== '' && data.apartment === 'Y'){
                            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                        }
                        // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                        if(extraAddr !== ''){
                            extraAddr = ' (' + extraAddr + ')';
                        }
                        // 조합된 참고항목을 해당 필드에 넣는다.
                        document.getElementById("sample3_extraAddress").value = extraAddr;
                    
                    } else {
                        document.getElementById("sample3_extraAddress").value = '';
                    }

                    // 우편번호와 주소 정보를 해당 필드에 넣는다.
                    document.getElementById('sample3_postcode').value = data.zonecode;
                    document.getElementById("sample3_address").value = addr;
                    // 커서를 상세주소 필드로 이동한다.
                    document.getElementById("sample3_detailAddress").focus();

                    // iframe을 넣은 element를 안보이게 한다.
                    // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
                    element_layer.style.display = 'none';
                },
                width : '100%',
                height : '100%',
                maxSuggestItems : 5
            }).embed(element_layer);

            // iframe을 넣은 element를 보이게 한다.
            element_layer.style.display = 'block';

            // iframe을 넣은 element의 위치를 화면의 가운데로 이동시킨다.
            initLayerPosition();
        }

        // 브라우저의 크기 변경에 따라 레이어를 가운데로 이동시키고자 하실때에는
        // resize이벤트나, orientationchange이벤트를 이용하여 값이 변경될때마다 아래 함수를 실행 시켜 주시거나,
        // 직접 element_layer의 top,left값을 수정해 주시면 됩니다.
        function initLayerPosition(){
            var width = 300; //우편번호서비스가 들어갈 element의 width
            var height = 400; //우편번호서비스가 들어갈 element의 height
            var borderWidth = 5; //샘플에서 사용하는 border의 두께

            // 위에서 선언한 값들을 실제 element에 넣는다.
            element_layer.style.width = width + 'px';
            element_layer.style.height = height + 'px';
            element_layer.style.border = borderWidth + 'px solid';
            // 실행되는 순간의 화면 너비와 높이 값을 가져와서 중앙에 뜰 수 있도록 위치를 계산한다.
            element_layer.style.left = (((window.innerWidth || document.documentElement.clientWidth) - width)/2 - borderWidth) + 'px';
            element_layer.style.top = (((window.innerHeight || document.documentElement.clientHeight) - height)/2 - borderWidth) + 'px';
        }
    </script>
                     
    <script>
        function orderup(pagenum){
            $.ajax({ 
                url: "/orderup", 
                data: "username=" + uid +"&name=" + $(".search-bar").val()+"&page="+pagenum,
                type: 'POST',
                dataType: "JSON", 
                
                success: function (result) { 
                    $(".search-bar").val('');
                    var str = "";
                    var str2 = "";
                    $.each(result.message, function(i){
                        var y = i+1;
                        str += "<tr class='active'>";
                        str += '<TD class="key" style="display:none;">' + y + '<input type="hidden" value="'+result.message[i].num+'"></TD><TD>' + result.message[i].name+ '</TD><TD>' + result.message[i].number + '</TD><TD>' +result.message[i].regident + 
                            '</TD><TD>' + result.message[i].target + '</TD><TD>' + result.message[i].address + '</TD><TD>' + result.message[i].guardname + 
                                '</TD><TD>' + result.message[i].guardtarget + '</TD><TD>' + result.message[i].manager + '</TD>';
                        str += '</tr>';
                    });
                    $(".tablenum").empty();
                    for(var y=result.articles.pnStart; y<=result.articles.pnEnd; y++){
                        str2 += "<span class='pagingnum p"+y+"' onclick='orderup("+y+")'>"+y+"</span>";
                        }
                    $(".active").hide();
                $(".table").append(str);
                $(".tablenum").append(str2);
                $(".totalcount").html(result.articles.totalCount+"명");

                $(document).ready(function(){
                    $(".p"+pagenum).css("background","#000000");
                    $(".p"+pagenum).css("color","#4b86b6");
                    $('.table').eq(1);
                    var tab_td = $(".table tbody tr td");
                    $(tab_td).hover(function(){
                    if($(this).parent().hasClass('tablemenu')!=1)$(this).parent().css({'border-top':'2px solid #000000','border-bottom':'2px solid #000000',"cursor":"pointer","opacity":"0.9"});
                        }, function() {
                    if($(this).parent().hasClass('tablemenu')!=1)$(this).parent().css({'border':'1px solid #bebebe',"opacity":"1"});
                    });
                    $(tab_td).click(function(){
                        if($(this).parent().hasClass('tablemenu')!=1){
                            orderuproad($(this).parent().children('td').eq(2).text());
                        }
                    });
                });
                } 
            });
        }

        var useprice = [];
        var notuseproduct = [];
        var notrentproduct = [];
        var labelname ='';
        var saleval = '';
        var nextdateresultsplit = [];
        var nextdatesplit = [];
        var nextdate = "";
        var nextdatearray = [];
        
        function orderuproad(number){
            $.ajax({ 
                url: "/orderupload", 
                data: "username=" + uid +"&number=" + number+"&company=<%=company%>",
                type: 'POST',
                dataType: "JSON", 
                async:false,
                success: function (result) { 
                    $('.productchk').parent().parent().remove();
                    tablecalc();
                    saleval = result.result[0]['sale'].replace(/ /g, "");
                    notuseproduct = [];
                    notrentproduct = [];
                    labelname = result.result[0]['name'];
                    useprice = [result.result2[0]['money']];
                    notuseproductreplace = result.result2[0]['notuseproduct'].replace(/(\[|\]|\')/g,'');
                    notrentproductreplace = result.result2[0]['notrentproduct'].replace(/(\[|\]|\')/g,'');
                    notuseproductreplace2 = notuseproductreplace.replace(/ /g,'');
                    notrentproductreplace2 = notrentproductreplace.replace(/ /g,'');
                    notuseproductsplit = notuseproductreplace2.split(',');
                    notrentproductsplit = notrentproductreplace2.split(',');
                    $.each(notuseproductsplit, function(i){
                        notuseproduct.push(notuseproductsplit[i]);
                    });
                    $.each(notrentproductsplit, function(i){
                        notrentproduct.push(notrentproductsplit[i]);
                    });
                    
                    nextdate = result.result2[0]['nextdate'];
                    nextdatesplit = nextdate.split(",");
                    var nextdateresult = [];
                    if(nextdatesplit=='[]'){
                        nextdatearray = [[result.result[0]['date1'].replace(/ /g, ""),result.result[0]['date2']]];
                    }else{
                        $.each(nextdatesplit, function(i){
                        nextdateresult.push(nextdatesplit[i].replace(/(\'|\||\[|\]|\ |\-)/g,''));
                        nextdateresultsplit = nextdateresult[nextdateresult.length-1].split("~");
                        nextdatearray.push(nextdateresultsplit);
                    });
                    nextdatearray.push([result.result[0]['date1'].replace(/ /g, ""),result.result[0]['date2']]);
                    }
                    $(".name").val(result.result[0]['name']);
                    $(".number").val(result.result[0]['number']);
                    $(".regident").val(result.result[0]['regident']);
                    $(".ranker").val(result.result[0]['ranker']);
                    $(".target").val(result.result[0]['target']);
                    $(".guardname").val(result.result[0]['guardname']);
                    $(".guardtarget").val(result.result[0]['guardtarget']);
                    $(".sale").val(String(result.result[0]['sale'].replace(/ /g, ""))).prop("selected", true);
                    $(".addressnum").val(result.result[0]['addressnum']);
                    $(".address1").val(result.result[0]['address']);
                    $(".address1_2").val(result.result[0]['addressdetail']);
                    $(".phone1").val(result.result[0]['phone1']);
                    $(".phone2").val(result.result[0]['phone2']);
                    $(".centername").val(result.result[0]['centername']);
                    $(".rentdatestart").val(result.result[0]['date1'].replace(/ /g, ""));
                    $(".rentdateend").val(result.result[0]['date2']);
                    $(".rentdatenextstart").val(nextdateresultsplit[0]);
                    $(".rentdatenextend").val(nextdateresultsplit[1]);
                    var targeted_popup_class = jQuery(".popup-close3").attr('data-popup-close');
                    $('[data-popup="' + targeted_popup_class + '"]').fadeOut(350);
                    $(".signimage").empty();
                    // $(".signimage").append("<image style='width:100px;' src='/img/sign/image_<%=company%>_"+result.result[0]['number']+".png'>");
                } 
            });
        }
            
        $(document).ready(function(){
            $('button').click(function(){
                $('.blind').animate({width:"toggle"},400);
            });
            
        });

        function enterkey() {
            if (window.event.keyCode == 13) {
                orderup(1);
            }
        }
    </script>

    <div class="popup" data-popup="popup-1">
        <div class="popup-inner">
            <div class="maincontainer2">
                <h1 class="title2"><span class="material-icons">supervisor_account</span>&nbsp;&nbsp;&nbsp;&nbsp;<%= title %></h1>
                <div class="search-form">
                    <input type="text" class="search-bar" name="query" placeholder=" 검색어를 입력하세요." onkeyup="enterkey();">
                    <input type="button" class="search-button material-icons" value="search" onclick=orderup(1); >
                </div>
                <table class="topmenu">
                    <tr>
                        <td class="clientup"><span>수급자등록하기</span></td>
                        <td>조회된 수급자:&nbsp;&nbsp;<span class="totalcount">명</span></td>
                    </tr>
                </table>
                <div class="tablescroll">
                <table class="table table-bordered">
                    <tr class="tablemenu">
                        <td style="display:none;" class="tablenum" colspan="20">
  
                        </td>
                    </tr>
                    <tr class="center tablemenu">
                        <td style="display:none;">번호</td>
                        <td>수급자성함</td>
                        <td>인정번호</td>
                        <td>생년월일</td>
                        <td>대상</td>
                        <td style="width:150px;">주소</td>
                        <td>보호자성함</td>
                        <td>관계</td>
                        <td>담당자</td>
                    </tr>

                </table>
                </div>
                </div>
            <a class="popup-close3" data-popup-close="popup-1" href="#">x</a>
        </div>
    </div>  

    <script>
        function orderupproduct(pagenum){
            $.ajax({ 
                url: "/orderupproduct", 
                data: "username=" + uid +"&name=" + $(".productsearch").val()+"&page="+pagenum,
                type: 'POST',
                dataType: "JSON", 
                
                success: function (result) { 
                    var str = "";
                    var str2 = "";
                    var productcnt = [];
                    $.each(result.message, function(i){
                        if(result.message[i].bcode!=null)productcnt=result.message[i].bcode.split("|");
                        if(result.message[i].target=="구입"){
                            buyrentchk = result.message[i].buyprice;
                        }else if(result.message[i].target=="대여"){
                            buyrentchk = result.message[i].rentprice;
                        }
                        var y = i+1;
                        str += "<tr class='active'>";
                        str += '<TD style="display:none;">' + y + '</TD><TD>' + result.message[i].name+ '</TD><TD>' + result.message[i].code + '</TD><TD>' +result.message[i].name2 + 
                            '</TD><TD>' + result.message[i].target + '</TD><TD>' + result.message[i].usechk + '</TD><TD>' + buyrentchk + 
                                '</TD><TD>' + productcnt.length + '</TD>';
                        str += '</tr>';
                    });
                    $(".tablenum").empty();
                    if($(".productsearch").val()==''){
                        $('.popup2container').css('overflow-y','unset');
                    for(var y=result.articles.pnStart; y<=result.articles.pnEnd; y++){
                        str2 += "<span class='pagingnum p"+y+"' onclick='orderupproduct("+y+")'>"+y+"</span>";
                        }
                    }else{
                        $('.popup2container').css('overflow-y','scroll');
                    }
                    $(".active").hide();
                $(".table").append(str);
                $(".tablenum").append(str2);
                if($(".productsearch").val()=='')$(".totalcount").html(result.articles.totalCount+"개"); else $(".totalcount").html(result.message.length+"개");

                $(document).ready(function(){
                    $(".p"+pagenum).css("background","#000000");
                    $(".p"+pagenum).css("color","#4b86b6");
                    var tab_td = $(".table tbody tr td");
                    $(tab_td).hover(function(){
                    if($(this).parent().hasClass('tablemenu')!=1)$(this).parent().css({'border-top':'2px solid #000000','border-bottom':'2px solid #000000',"cursor":"pointer","opacity":"0.9"});
                        }, function() {
                    if($(this).parent().hasClass('tablemenu')!=1)$(this).parent().css({'border':'1px solid #bebebe',"opacity":"1"});
                    });
                    $(tab_td).click(function(){
                        if($(this).parent().hasClass('tablemenu')!=1){
                            orderupproductload($(this).parent().children('td').eq(2).text(),'1','n');
                        }
                    });
                });
                } 
            });
        }

        var buycode = [];
        var rentcode = [];
        var rentclass= "";
        var buypricesum = [];
        var buypricedansum = [];
        var buypricegongsum = [];
        var buychk= '';
        var buyrentchk=0;
        var datetotal = [];
        var contractchk = "<%=result[0].chk%>";
        var rentend = "<%=result[0].rentend%>";
        var targetclass= "";
        var targetname = "";
        var saledates = ''
        function bocdesalelist(x){
            if(x!=''){
                $.ajax({ 
                    url: "/bcodesalelist", 
                    data: "company=<%=company%>" +"&bcode=" + x,
                    type: 'POST',
                    dataType: "JSON", 
                    async:false,
                    success: function (result) { 
                        if(result.data!=''){
                            saledates= result.data[0].date;
                        }
                    }
                });
            }
        }

        var rental = '';
        var rentalchk = 'n';
        function rentalbcode(x){
            if(x!=''){
                $.ajax({ 
                    url: "/rentalbcode", 
                    data: "bcode=" + x+"&company=" + company,
                    type: 'POST',
                    dataType: "JSON", 
                    async:false,
                    success: function (result) { 
                        if(result.result!=''){
                            rental = '['+result.result[0].rental+']';
                            rentalchk = 'y';
                        }else{
                            rental = '';
                            rentalchk = 'n';
                        }
                    }
                });
            }
        }

        function orderupproductload(number,cnt,chk,buybcode,target){
            $.ajax({ 
                url: "/orderupproductload", 
                data: "username=" + uid +"&number=" + number,
                type: 'POST',
                dataType: "JSON", 
                async:false,
                success: function (result) { 
                    if(chk=='y'){
                        buychk='checked';
                    }else{
                        buychk='';
                    }
                    var str="";
                    var str2="";
                    var countchk = "";
                    var countchk2 = "";
                    rentclass = "";
                    var contracttxt = "미계약";
                    var saletxt = '';
                    targetclass="";
                    $.each(notuseproduct, function(i){
                        if(result.result[0].name==notuseproduct[i]){
                            countchk = '<span class="material-icons countchk" title="사용불가품목">priority_high</span>';
                        }
                    });
                    $.each(notrentproduct, function(i){
                        if(result.result[0].name==notrentproduct[i]){
                            countchk2 = '<span class="material-icons countchk" title="대여불가품목">priority_high</span>';
                        }
                    });
                    if(target.length<0||target==''||target==null)targetname = "구입";
                    if(target.length>0)targetname = "대여";
                    if(targetname=="대여"){
                        rentclass = "rentclass";
                        //rentcode.push(result.result[0].code+"|"+result.result[0].name2);
                    }
                    buycode.push(result.result[0].code+"|"+result.result[0].name2);
                    salevalreplace = saleval.replace(/(\.|\%|0)/g,'');
                    if(salevalreplace=='6'){
                        salevalreplace = 0.06;
                    }
                    if(salevalreplace=='9'){
                        salevalreplace = 0.09;
                    }
                    if(salevalreplace=='15'){
                        salevalreplace = 0.15;
                    }
                    if(targetname=="구입"){
                        targetclass = "buycls";
                        buyrentchk = result.result[0].buyprice;
                    }else if(targetname=="대여"){
                        targetclass = "rentcls";
                        buyrentchk = result.result[0].rentprice;
                    }
                        
                    buypricedansum.push(parseInt(buyrentchk));
                    buypricesum.push(parseInt(buyrentchk*salevalreplace));
                    buypricegongsum.push(parseInt(buyrentchk*(1-salevalreplace)));
                    if(cnt==undefined) cnt = 1;
                    if(buybcode=='direct'){
                        buybcode='';
                    }
                    rentalbcode(buybcode);
                    str += "<tr class='active2 cartlist "+targetclass+"'>";
                    str += '<TD style="display:none;"><input class="productchk" type="checkbox"></TD><TD class="pdfcode mobile">' + result.result[0].code+ '<input class="renttarget" type="hidden" value='+targetname+'></TD><TD><input class="gongbcodetxt bcodeinput" style="width:70%;" type="text" value="'+buybcode+'">'+rental+'</TD><TD class="flex countchktd mobile"><span class="pdfname">' + result.result[0].name +'</span>'+ countchk+countchk2+'</TD><TD class="pdfname2 '+rentclass+' gongnametxt">' +result.result[0].name2 + 
                            '</TD><TD><input class="gongstarttxt" style="width:95%; border:2px solid #122459;" type="text" value="'+'<%=result[0].rentstart%>'.replace(/(\-)/g, '')+'" onchange="inputchange2(this);"></TD><TD><input style="width:95%; border:2px solid #122459;" id="'+inko.ko2en(result.result[0].name.replace(/(\(|\)| )/g,''))+'" class="'+inko.ko2en(result.result[0].name.replace(/(\(|\)| )/g,''))+'txt gongendtxt" style="width:100%;" type="text" value="'+rentend.replace(/(\-|\/)/g,'')+'" onchange="inputchange2(this);"></TD><TD class="buypricedan mobile">' + (parseInt(buyrentchk)*cnt.toLocaleString()) + '원</TD><TD class="buyprice mobile">' + (parseInt(buyrentchk*salevalreplace)*cnt.toLocaleString()) + 
                                '원</TD><TD class="buypricegong mobile">' + (parseInt(buyrentchk*(1-salevalreplace))*cnt.toLocaleString()) + '원</TD><TD class="mobile" tyle="color:#2F9D27"><input type="checkbox" class="buychk" '+buychk+' disabled/></TD>';
                    str += '</tr>';
                    bocdesalelist(buybcode);
                    var newsaledates = '';
                    var newsaledates2 = '';
                    var salecnt = 5;
                    if(result.result[0].name=='전동침대')salecnt=10;
                    if(result.result[0].name=='욕창예방 매트리스')salecnt=3;
                    if(saledates!=''){
                        newsaledates = new Date(saledates);
                        newsaledates2 = new Date(saledates);
                        newsaledates.setFullYear(newsaledates.getFullYear() + salecnt);
                        newsaledates2.setFullYear(newsaledates2.getFullYear() + salecnt);
                        newsaledates.setDate(newsaledates.getDate() - 1);
                        newsaledates = dateFormat(newsaledates);
                        newsaledates2 = dateFormat(newsaledates2);
                        
                        $.each(nextdatearray,function(i){
                            if(new Date(nextdatearray[nextdatearray.length-(i+1)][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))>new Date(newsaledates)&&new Date(nextdatearray[nextdatearray.length-(i+1)][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))<new Date(newsaledates)){
                                nextdatearray.splice((nextdatearray.length-(i+1))+1,0,[nextdatearray[nextdatearray.length-(i+1)][0],newsaledates.replace(/-/g,'')]);
                                nextdatearray[nextdatearray.length-(i+2)].shift();
                                nextdatearray[nextdatearray.length-(i+2)].splice(0,0,newsaledates2.replace(/-/g,''));
                                return false
                            }
                        });
                    }
                    var rentendnew = new Date(rentend.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
                    $.each(nextdatearray, function(i){
                        datetotal.push(nextdatearray[nextdatearray.length-(i+1)][1]);
                        if(rentendnew >= new Date(nextdatearray[nextdatearray.length-(i+1)][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3')) && contractchk == "ok"){
                            contracttxt = "계약";
                            conchk = "done";
                        }else{
                            contracttxt = "미계약";
                            conchk = "";
                        }
                        if(nextdatearray[nextdatearray.length-(i+1)][1]==newsaledates.replace(/-/g,''))saletxt = '<span style="color:#ff0000;">내구연한만료지점</span>'; else saletxt = '';
                    str2 += "<tr class='active2 cartlist' style='height:30px;'>";
                    str2 += '<TD style="display:none;"><input style="display:none;" class="productchk" type="checkbox"></TD><TD class="contracttxt" style="color:#878787;">'+contracttxt+'<br/>'+saletxt+'</TD><TD><span style="color:#008b17" class="inputdatechk material-icons">'+conchk+'</span></TD><TD class="flex countchktd"><span class="'+inko.ko2en(result.result[0].name.replace(/(\(|\)| )/g,''))+'">' + result.result[0].name +'</span>'+ countchk+countchk2+'</TD><TD class="pdfname2">' +result.result[0].name2 + 
                            '</TD><TD>'+nextdatearray[nextdatearray.length-(i+1)][0]+'</TD><TD>'+nextdatearray[nextdatearray.length-(i+1)][1]+'</TD><td><input class="rentdatebutton" type="button" style="width:70px; height:30px;" value="적용" onclick="dateupdate(this);"></td>';
                    str2 += '</tr>';
                    });
                    $(".productload").append(str);
                    $(".productload2").append(str2);
                    if(resultchk=='ok'){
                        $('.rentdatebutton').hide();
                    }
                    if(nextdatearray[0][1].replace(/ |-/g,'')=='<%=result[0].rentend%>'.replace(/ |-/g,'')){
                        $('.nxdrelookup').html("<span class='mobile' style='color:#ff1100; font-size:12px; font-weight:bold; padding:10px;'>! 연장계약시 적용구간 갱신 필요</span><span class='relookup' onclick='relookup();'>재조회</span>");
                    }
                    $('.countchk').tooltip({
                        position: { my: "left+5 center", at: "right center" }
                    });
                    if(targetname=="대여") rentcode.push($('.rentclass').last().prevAll('.pdfcode').text()+"|"+$('.rentclass').last().text());
                    tablecalc();
                    /*
                    $(".name").val(result.result[0]['name']);
                    $(".number").val(result.result[0]['number']);
                    $(".regident").val(result.result[0]['regident']);
                    $(".ranker").val(result.result[0]['ranker']);
                    $(".target").val(result.result[0]['target']);
                    $(".guardname").val(result.result[0]['guardname']);
                    $(".guardtarget").val(result.result[0]['guardtarget']);
                    $(".sale").val(String(result.result[0]['sale'].replace(/ /g, ""))).prop("selected", true);
                    $(".addressnum").val(result.result[0]['addressnum']);
                    $(".address1").val(result.result[0]['address']);
                    $(".address1_2").val(result.result[0]['addressdetail']);
                    $(".phone1").val(result.result[0]['phone1']);
                    $(".phone2").val(result.result[0]['phone2']);
                    $(".centername").val(result.result[0]['centername']);
                    var targeted_popup_class = jQuery(".popup2-close3").attr('data-popup2-close');
                    $('[data-popup2="' + targeted_popup_class + '"]').fadeOut(350);
                    $(".signimage").empty();
                    $(".signimage").append("<image style='width:100px;' src='/img/sign/image_"+uid+"_"+result.result[0]['number']+".png'>");
                    */
                } 
            });
        }
            
        function dateupdate(a){
            var updatename = $(a).parent().prev().prev().prev().prev().text();
            var dateup1 = $(a).parent().prev().text();
            $('#'+inko.ko2en(updatename.replace(/(\(|\)| )/g,''))).val(dateup1);
            inputchange('.'+inko.ko2en(updatename.replace(/(\(|\)| )/g,''))+'txt',a,inko.ko2en(updatename.replace(/(\(|\)| )/g,'')));
        }
        
        var inputarray = [];
        var inputarraymax = [];
        
        function inputchange2(x){
            $(x).val($(x).val().replace(/(\-|\/)/g,''));
        }
        
        function inputchange(x,y,z){
            var findlen = $('.'+z).parent().siblings().find('.inputdatechk').length;
            var inputreplace = new Date($(x).val().replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
            $.each(nextdatearray, function(i){
                inputarray.push(nextdatearray[i][0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
                inputarraymax.push(nextdatearray[i][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
            });
            $.each(inputarray, function(i){
                if(inputreplace>new Date(inputarray[i])){
                    $('.'+z).parent().siblings().find('.inputdatechk').eq(findlen-(i+1)).html('done');
                    //$('.inputdatechk').eq($('.inputdatechk').length-(i+1)).html('done'); 
                }else{
                    $('.'+z).parent().siblings().find('.inputdatechk').eq(findlen-(i+1)).html(' ');
                } 
            });
            if(inputreplace>new Date(inputarraymax[0])){ 
                //alert('대여계약 가능구간을 넘었습니다.'); 
                Swal.fire(
                    '대여계약 가능구간을 넘었습니다.',
                    '',
                    'warning'    
                );
                $('.gongendtxt').val(inputarraymax[0].replace(/(\-)/g, ''));
            }
        }
            
        function stopdatechk(x){
            var formatNum1 = $(x).val().replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3');
            var formatNum2 = '<%=result[0].rentend%>'.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3');
            if(formatNum1>=formatNum2){
                Swal.fire(
                    '계약종료일과 동일하거나 클수없습니다',
                    '',
                    'warning'    
                );
                //$(x).val(chan_val);
            }
        }

        $(document).ready(function(){
            $( document ).tooltip();
            $('button').click(function(){
                $('.blind').animate({width:"toggle"},400);
            });
            
            $('.deletebutton span').eq(0).click(function(){
                $('.productchk').prop('checked',true);
                
            });
            $('.deletebutton span').eq(1).click(function(){
                $('.productchk').prop('checked',false);
                
            });
            var buyindex=[];
            var deleterentname=[];
            $('.deletebutton span').eq(2).click(function(){
                buyindex=[];
                deleterentname=[];
                $($('.productchk')).each(function (index) {
                    if($(this).is(":checked")==true){
                        deleterentname.push($(this).parent().next().text());
                        buyindex.push(index);
                        $(this).parent().parent().remove();
                        tablecalc();
                    }
                });
                $(buyindex).each(function(index){
                    delete buypricedansum[buyindex[index]];
                    delete buypricesum[buyindex[index]];
                    delete buypricegongsum[buyindex[index]];
                    delete buycode[buyindex[index]];
                });
                $(rentcode).each(function(i){
                    if(rentcode[i].includes(deleterentname)){
                        delete rentcode[i];
                    }
                });
                rentcode = rentcode.filter(function (el) {
                return el != null;
                });
                buypricedansum = buypricedansum.filter(function (el) {
                return el != null;
                });
                buypricesum = buypricesum.filter(function (el) {
                return el != null;
                });
                buypricegongsum = buypricegongsum.filter(function (el) {
                return el != null;
                });
                buycode = buycode.filter(function (el) {
                return el != null;
                });
            });	
                
        });
        
        function inputkeyup(x){
            buypricedansumresult = buypricedansum[$('.cartlist').index($(x).parent().parent())]*$(x).val();
            buypricesumresult = buypricesum[$('.cartlist').index($(x).parent().parent())]*$(x).val();
            buypricegongsumresult = buypricegongsum[$('.cartlist').index($(x).parent().parent())]*$(x).val();
            $(x).parent().next().html(buypricedansumresult.toLocaleString()+'원');
            $(x).parent().next().next().html(buypricesumresult.toLocaleString()+'원');
            $(x).parent().next().next().next().html(buypricegongsumresult.toLocaleString()+'원');
            tablecalc();
        }
        
        var regex = /(\,|\]|\'|\(|\)|\"|원)/g; // 숫자가 아닌 문자열을 선택하는 정규식
            
        function tablecalc(){
            var buypricetotal = 0;
            var buypricetotaldan = 0;
            var buypricetotalgong = 0;
            var buycnttotal = 0;
            var renttarget = [];
            var pricechk = '';
            for(var i=0; i<$('.renttarget').length; i++){
                text=$('.renttarget').eq(i).val();
                renttarget.push(text);
                if(renttarget.indexOf('대여')!==-1){
                    $('.rentdate').show();
                    $('.gray_btn').show();
                    $('.rentmemo').show();
                }else{
                    $('.rentmemo').hide();
                    $('.rentdate').hide();
                    $('.gray_btn').hide();
                }
            }
            for(var i=0; i<$('.buyprice').length; i++){
                    text=$('.buyprice').eq(i).text();
                    buypricetotal += parseInt(text.replace(regex, ""));
            }
            for(var i=0; i<$('.buypricedan').length; i++){
                    text=$('.buypricedan').eq(i).text();
                    buypricetotaldan += parseInt(text.replace(regex, ""));
            }
            for(var i=0; i<$('.buypricegong').length; i++){
                    text=$('.buypricegong').eq(i).text();
                    buypricetotalgong += parseInt(text.replace(regex, ""));
            }
            for(var i=0; i<$('.buycnt').length; i++){
                    text=$('.buycnt').eq(i).val();
                    buycnttotal += parseInt(text.replace(regex, ""));
            }
            if(buypricetotaldan>useprice) {
                var overprice = buypricetotaldan-useprice;
                pricechk = '<span class="material-icons countchk" title="'+labelname+'님 구매가능금액 '+overprice.toLocaleString()+'원 초과입니다. 구매가능금액:'+parseInt(useprice).toLocaleString()+'원">&nbsp;priority_high&nbsp;</span>';
            }
            $('.buypricetotal').html(buypricetotal.toLocaleString()+"원");
            // $('.buypricetotaldan').html(buypricetotaldan.toLocaleString()+"원"+pricechk);
            $('.buypricetotaldan').html(buypricetotaldan.toLocaleString()+"원");
            $('.buypricetotalgong').html(buypricetotalgong.toLocaleString()+"원");
            $('.buycnttotal').html(buycnttotal+"개");
        }
        
        var addtarget = 0;
        var buypricedansumresult = 0;
        var buypricesumresult = 0;
        var buypricegongsumresult = 0;
        
        function add(x){
            addtarget = $(x).prev().val();
            $(x).prev().val(parseInt(addtarget)+1);
            buypricedansumresult = buypricedansum[$('.cartlist').index($(x).parent().parent())]*$(x).prev().val();
            buypricesumresult = buypricesum[$('.cartlist').index($(x).parent().parent())]*$(x).prev().val();
            buypricegongsumresult = buypricegongsum[$('.cartlist').index($(x).parent().parent())]*$(x).prev().val();
            $(x).parent().next().html(buypricedansumresult.toLocaleString()+'원');
            $(x).parent().next().next().html(buypricesumresult.toLocaleString()+'원');
            $(x).parent().next().next().next().html(buypricegongsumresult.toLocaleString()+'원');
            tablecalc();
        }   
            
        function remove(x){
            removetarget = $(x).next().val();
            $(x).next().val(parseInt(removetarget)-1);
            buypricedansumresult = buypricedansum[$('.cartlist').index($(x).parent().parent())]*$(x).next().val();
            buypricesumresult = buypricesum[$('.cartlist').index($(x).parent().parent())]*$(x).next().val();
            buypricegongsumresult = buypricegongsum[$('.cartlist').index($(x).parent().parent())]*$(x).next().val();
            $(x).parent().next().html(buypricedansumresult.toLocaleString()+'원');
            $(x).parent().next().next().html(buypricesumresult.toLocaleString()+'원');
            $(x).parent().next().next().next().html(buypricegongsumresult.toLocaleString()+'원');
            tablecalc();
        }

        function submitorder(x){
            var now = new Date();
            var year= now.getFullYear();
            var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
            var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
            var chan_val = year +''+ mon +''+ day;
            var list = {};
            if(x=="back"){
                $.ajax({ 
                    url: "/deliverycarlist2", 
                    data: "company=" + company,
                    type: 'POST',
                    dataType: "JSON", 
                    success: function (result) { 
                        $.each(result.result,function(i){
                            list[result.result[i].car] = result.result[i].car;
                        });
                        Swal.fire({
                            width: '1000px',
                            fontsize:'15px',
                            title: '회수등록 하시겠습니까?',
                            text: "회수등록 하시겠습니까?",
                            html: "<div style='display:flex; flex-direction:column; justify-content:center; align-items:center;'>"+
                                "<table class='nrent_swal_table'><tbody class='nrent_swal'>"+
                                "<tr><td>선택</td><td>품목코드</td><td>바코드</td><td>품목</td><td>품목명</td><td>본인부담금</td></tr>"+
                                "</tbody></table>"+
                                "<div style='font-weight:bold; font-size:17px;'>회수등록일</div><input id='datepicker5' type='text' style='height:25px; width:120px; text-align:center; font-weight:bold; font-size:16px;'>"+
                                "<div>회수사유</div><input class='canclet' type='text' style='height:25px;'>"+
                                "</div>",
                            didOpen:function(){
                                
                                let nrent_swal = "";
                                $.each($('.rentcls'),function(i){
                                    nrent_swal += "<tr>"+
                                        "<td><input type='checkbox' class='nrent_swal_chk' style='width:25px; height:25px;' checked></td><td>"+$(this).children('td').eq(1).text()+"</td><td>"+$(this).children('td').eq(2).children('input').val()+"</td><td>"+$(this).children('td').eq(3).text()+"</td><td>"+$(this).children('td').eq(4).text()+"</td><td class='nrent_swal_money'>"+$(this).children('td').eq(8).text()+"</td>"+
                                        "</tr>";
                                });
                                $('.nrent_swal').append(nrent_swal);
                            },
                            icon: 'question',
                            //input: 'select',
                            //inputOptions: list,
                            //inputPlaceholder: '회수차량선택',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: '회수',
                            cancelButtonText: '취소',
                            allowOutsideClick: false,
                        }).then((result) => {
                            if (result.isConfirmed) {
                                let plen = $('.rentcls').length;
                                let nrent_swal_chk_cnt = 0;
                                let nrent_chk_idx = [];
                                let nrent_nchk_idx = [];
                                let nrent_money = [];
                                let nrent_nmoney = [];
                                $.each($('.nrent_swal_chk'),function(i){
                                    if($(this).is(':checked')){
                                        nrent_swal_chk_cnt++;
                                        nrent_chk_idx.push(i);
                                        nrent_money.push(parseInt($('.nrent_swal_money').eq(i).text().replace('원','')));
                                    }else{
                                        nrent_nchk_idx.push(i);
                                        nrent_nmoney.push(parseInt($('.nrent_swal_money').eq(i).text().replace('원','')));
                                    }
                                });
                                if(nrent_swal_chk_cnt==0){
                                    Swal.fire(
                                        '회수 품목을 선택해주세요',
                                        '',
                                        'error'
                                    );
                                }else if(plen==nrent_swal_chk_cnt){
                                    nrent_chk_idx = ['all'];
                                }
                                console.warn("idx:",nrent_chk_idx);
                                $.ajax({
                                    url: "/nrentdelivery",
                                    data: "id=" + uid + "&company=" + company+ "&num="+key + "&orderkey=<%=result[0].orderkey%>"+ "&car="+$('.swal2-select').val()+ "&cancled="+$('#datepicker5').val().replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3')+ "&canclet="+$('.canclet').val()+"&idx="+nrent_chk_idx+"&nidx="+nrent_nchk_idx+"&money="+nrent_money+"&nmoney="+nrent_nmoney,
                                    type: 'POST',
                                    dataType: "JSON",
                                    success: function (result) {
                                        if(result){
                                            Swal.fire(
                                                '회수처리되었습니다.',
                                                '',
                                                'success'
                                            ).then((result) => {
                                            if (result.isConfirmed) {
                                                location.reload();
                                                }
                                            });
                                        }else{
                                            Swal.fire(
                                                '회수주문이 없습니다.',
                                                '',
                                                'error'
                                            );
                                        }
                                    }
                                });
                            }
                        });
                        $("#datepicker5" ).datepicker({
                            changeMonth: true,
                            changeYear: true
                        });
                        $("#datepicker5" ).datepicker( "option", "showAnim", "slide" );
                        $("#datepicker5").val(chan_val);
                    }
                });
            }else if(x=='stop'){
                let ccnow = new Date();
                let checkDate = new Date('2025-04-01T08:00:00');
                
                if (ccnow < checkDate) {
                    Swal.fire({//
                        width:'40%',
                        icon: 'warning',
                        title: '건강보험공단 전산시스템 점검',
                        html: `보건복지부 사회보장정보시스템의 점검으로 인하여  ‘복지용구 급여계약’이 불가능
하오니 업무에 참조하시기 바랍니다.<br/>
 ○ 중단일시 : 25.3.28.(금) 08:00 ~  25.4.1.(화) 08:00<br/>
 ○ 중단업무 : 사회보장정보시스템(행복e음, 범정부) 서비스 전반<br/>
  ※ 해당기간 동안 '복지용구 급여계약' 업무를 중단하여 주시기 바랍니다.<br/>
  ※ 긴급히 공지 드린 점 양해부탁드립니다.`,
                    });
                    return 0;
                }
                if($('.bcodeinput').eq(0).val()==''){
                    Swal.fire(
                        '바코드 미입력',
                        '품목 바코드를 입력해주세요',
                        'warning'
                    )
                }else{
                    var confirmdatatxt = '';
                    var txt2 = '사유';
                    for(var i=0; i<$('.gongbcodetxt').length; i++){
                        confirmdatatxt += '<tr class="adddata"><td class="pcode mobile">'+$('.pdfcode').eq(i).text()+'</td><td class=""><input class="cbcode bcodeinput" style="height:20px; font-weight:bold;" type="text" value="'+$('.gongbcodetxt').eq(i).val()+'" readonly></td><td class="cproductname">'+$('.gongnametxt').eq(i).text()+'</td><!--td><select class="canclex" style="height:30px;"><option value="반품">반품</option><option value="착오계약">착오계약</option><option value="자격변동">자격변동</option></select></td--></tr>';
                    }
                    Swal.fire({
                        width: '500px',
                        fontsize:'15px',
                        title: '대여 중지 하시겠습니까?',
                        html: '<table class="confirmtable">'+
                        '<tr>'+
                        '<td class="mobile">품목코드</td><td>바코드</td><td>품목명</td><!--td>'+txt2+'</td-->'+
                        '</tr>'+confirmdatatxt+
                        '</table>'+
                        "<div style='display:flex; flex-direction:column; justify-content:center; align-items:center;'><div></div><div style='font-weight:bold; font-size:17px;'>중지날짜</div><input id='datepicker5' type='text' style='height:25px; width:120px; text-align:center; font-weight:bold; font-size:16px;' onchange='stopdatechk(this);'><div>중지사유</div><input class='canclet' type='text' style='height:25px;'></div>",
                        icon: 'question',
                        //input: 'select',
                        //inputOptions: list,
                        //inputPlaceholder: '회수차량선택',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: '중지',
                        cancelButtonText: '취소',
                        allowOutsideClick: false,
                    }).then((result) => {
                        if (result.isConfirmed) {
                            var pcodelist = [];
                            var cbcodelist = [];
                            var cproductnamelist = [];
                            var cproductnamelist2 = [];
                            var cdatelist2 = [];
                            var sdate = [];
                            var canclex = [];
                            var rentproduct = [];
                            $.each($('.gongbcodetxt'),function(i){
                                rentproduct.push($('.pcode').eq(i).text()+"|"+$('.cproductname').eq(i).text());
                                pcodelist.push($('.pcode').eq(i).text());
                                cbcodelist.push($('.cbcode').eq(i).val().replace(/ /g, ""));
                                cproductnamelist.push($('.cproductname').eq(i).text());
                                cproductnamelist2.push($('.pdfname').eq(i).text());
                                cdatelist2.push($('#datepicker5').val().replace(/(\-|\/| )/g,''));
                                canclex.push('반품');
                            });
                            $.ajax({ 
                                url: "/rentbcodemodify", 
                                data: "id=" + uid +"&company=" + company +"&key=" + key + "&rentbcode="+cbcodelist + "&rentproduct="+rentproduct,
                                type: 'POST',
                                dataType: "JSON", 
                                success: function (result) { 
                                } 
                            });
                            socket.emit('disconnect2', {'name': uid});
                            socket.emit('login', {'name': uid});
                            
                            var phonenum = '<%=result[0].phone%>';
                            phonenum = phoneNumber(phonenum.replace(' ',''));
                            socket.emit('rentstop', {'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>'+';'+cproductnamelist2+';'+canclex+";"+cdatelist2+";"+cbcodelist+";"+rentalchk+";"+pcodelist+';<%=result[0].num%>;<%=result[0].orderkey%>;s;<%=result[0].rentend%>;'+$('.canclet').val()});
                            socket_chk = 1;
                            Swal.fire({
                                title: '중지계약진행중입니다.',
                                showConfirmButton:false,
                                didOpen: () => {
                                    Swal.showLoading();
                                },
                                allowOutsideClick: false,
                            });
                        }
                    });
                    $("#datepicker5" ).datepicker({
                        changeMonth: true,
                        changeYear: true
                    });
                    $("#datepicker5" ).datepicker( "option", "showAnim", "slide" );
                    $("#datepicker5").val(chan_val);  
                }
                
            }else if(x=='stopc'){
                let ccnow = new Date();
                let checkDate = new Date('2025-04-01T08:00:00');
            
            if (ccnow < checkDate) {
                Swal.fire({//
                    width:'40%',
                    icon: 'warning',
                    title: '건강보험공단 전산시스템 점검',
                    html: `보건복지부 사회보장정보시스템의 점검으로 인하여  ‘복지용구 급여계약’이 불가능
하오니 업무에 참조하시기 바랍니다.<br/>
 ○ 중단일시 : 25.3.28.(금) 08:00 ~  25.4.1.(화) 08:00<br/>
 ○ 중단업무 : 사회보장정보시스템(행복e음, 범정부) 서비스 전반<br/>
  ※ 해당기간 동안 '복지용구 급여계약' 업무를 중단하여 주시기 바랍니다.<br/>
  ※ 긴급히 공지 드린 점 양해부탁드립니다.`,
                });
                return 0;
            }
                $.ajax({
                    url:'/rentstoptable',
                    data:'company=<%=result[0].company%>&key='+key,
                    dataType:'JSON',
                    type:'POST',
                    success:function(result){
                        if(result.code==200){
                            var cnow = new Date(ymdformat(result.data[0].stopdates));
                            var yesterday2 = new Date(cnow.setDate(cnow.getDate() + 1));
                            var ryear = yesterday2.getFullYear();
                            var rmon = (yesterday2.getMonth() + 1) > 9 ? '' + (yesterday2.getMonth() + 1) : '0' + (yesterday2.getMonth() + 1);
                            var rday = yesterday2.getDate() > 9 ? '' + yesterday2.getDate() : '0' + yesterday2.getDate();
                            var rentstopstartdate2= ryear+rmon+rday;
                            console.warn(rentstopstartdate2);
                            
                            var yesterday = cnow;
                            var yyear = yesterday.getFullYear();
                            var ymon = (yesterday.getMonth() + 1) > 9 ? '' + (yesterday.getMonth() + 1) : '0' + (yesterday.getMonth() + 1);
                            var yday = yesterday.getDate() > 9 ? '' + yesterday.getDate() : '0' + yesterday.getDate();
                            var cleandate = yyear+ymon+yday;
                            confirmdatatxt="";
                            for(var i=0; i<$('.gongbcodetxt').length; i++){
                                confirmdatatxt += '<tr class="adddata"><td class="pcode mobile">'+$('.pdfcode').eq(i).text()+'</td><td class="gongbcode cbcode">'+$('.gongbcodetxt').eq(i).val()+'</td><td class="cproductname">'+$('.gongnametxt').eq(i).text()+'</td><td class="sdate">'+result.data[0].stopdates+'</td><td class="edate">'+result.data[0].stopundo+'</td></tr>';
                            }
                            confirmdatatxt += '</table><br/>';

                            Swal.fire({
                                width: '700px',
                                fontsize:'15px',
                                title: '대여 중지 취소 하시겠습니까?',
                                html: '<table class="confirmtable">'+
                                '<tr>'+
                                '<td class="mobile">품목코드</td><td>바코드</td><td>품목명</td><td>중지일</td><td>이전<br/>종료일</td>'+
                                '</tr>'+confirmdatatxt,
                                icon: 'question',
                                //input: 'select',
                                //inputOptions: list,
                                //inputPlaceholder: '회수차량선택',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: '확인',
                                cancelButtonText: '취소',
                                allowOutsideClick: false,
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    $.ajax({
                                        url:'/stopcleantable',
                                        data:'company=<%=result[0].company%>&bcode='+ $('.gongbcodetxt').eq(0).val(),
                                        dataType:'JSON',
                                        type:'POST',
                                        success:function(result){
                                            if(result.code==200){
                                                var pcodelist = [];
                                                var cbcodelist = [];
                                                var cproductnamelist = [];
                                                var cproductnamelist2 = [];
                                                var cdatelist = [];
                                                var cdatelist2 = [];
                                                var sdate = [];
                                                var canclex = [];
                                                var rentproduct = [];
                                                $.each($('.gongbcodetxt'),function(i){
                                                    rentproduct.push($('.pcode').eq(i).text()+"|"+$('.cproductname').eq(i).text());
                                                    pcodelist.push($('.pcode').eq(i).text());
                                                    cbcodelist.push($('.cbcode').eq(i).text().replace(/ /g, ""));
                                                    cproductnamelist.push($('.cproductname').eq(i).text());
                                                    cproductnamelist2.push($('.pdfname').eq(i).text());
                                                    cdatelist.push(rentstopstartdate2.replace(/(\-)/g,''));
                                                    cdatelist2.push($('.edate').eq(i).text().replace(/(\-|\/)/g,''));
                                                });
                                                socket.emit('disconnect2', {'name': uid});
                                                socket.emit('login', {'name': uid});
                                                
                                                var phonenum = '<%=result[0].phone%>';
                                                phonenum = phoneNumber(phonenum.replace(' ',''));
                                                if(cdatelist.length>0){
                                                    if(new Date(cdatelist[0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))>new Date(nextdatearray[nextdatearray.length-1][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))){
                                                        nextdatearray.pop();
                                                    }
                                                }
                                                socket.emit('rentcontract', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>;<%=result[0].guardname%>;<%=result[0].guardtarget%>;'+phonenum+';'+cbcodelist+";"+cproductnamelist2+";"+pcodelist+";"+cdatelist+";"+cdatelist2+";"+result.data[0].companyname+";"+result.data[0].companynumber+";;"+result.data[0].meditxt+";"+result.data[0].mediname+";"+result.data[0].medisize+";nomedi;"+datetotal+";"+nextdatearray+";"+cleandate+';<%=result[0].num%>;<%=result[0].orderkey%>;s;<%=result[0].manager%>'+';'+h_ranker+';'+'<%=client[0].rcgt?client[0].rcgt.split("~")[0].replace(/-/g,"").replace(/ /g,""):""%>'+';'+h_regident});
                                                socket_chk = 1;
                                                Swal.fire({
                                                    title: '계약진행중입니다.',
                                                    showConfirmButton:false,
                                                    didOpen: () => {
                                                        Swal.showLoading();
                                                    },
                                                    allowOutsideClick: false,
                                                });
                                            }else{
                                                // Swal.fire(
                                                //     '기존 소독내역이 없습니다',
                                                //     '',
                                                //     'error',
                                                // );
                                                var pcodelist = [];
                                                var cbcodelist = [];
                                                var cproductnamelist = [];
                                                var cproductnamelist2 = [];
                                                var cdatelist = [];
                                                var cdatelist2 = [];
                                                var sdate = [];
                                                var canclex = [];
                                                var rentproduct = [];
                                                $.each($('.gongbcodetxt'),function(i){
                                                    rentproduct.push($('.pcode').eq(i).text()+"|"+$('.cproductname').eq(i).text());
                                                    pcodelist.push($('.pcode').eq(i).text());
                                                    cbcodelist.push($('.cbcode').eq(i).text().replace(/ /g, ""));
                                                    cproductnamelist.push($('.cproductname').eq(i).text());
                                                    cproductnamelist2.push($('.pdfname').eq(i).text());
                                                    cdatelist.push(rentstopstartdate2.replace(/(\-)/g,''));
                                                    cdatelist2.push($('.edate').eq(i).text().replace(/(\-|\/)/g,''));
                                                });
                                                socket.emit('disconnect2', {'name': uid});
                                                socket.emit('login', {'name': uid});
                                                var phonenum = '<%=result[0].phone%>';
                                                phonenum = phoneNumber(phonenum.replace(' ',''));
                                                if(cdatelist.length>0){
                                                    if(new Date(cdatelist[0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))>new Date(nextdatearray[nextdatearray.length-1][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))){
                                                        nextdatearray.pop();
                                                    }
                                                }
                                                socket.emit('rentcontract', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>;<%=result[0].guardname%>;<%=result[0].guardtarget%>;'+phonenum+';'+cbcodelist+";"+cproductnamelist2+";"+pcodelist+";"+cdatelist+";"+cdatelist2+";;;;;;;nomedi;"+datetotal+";"+nextdatearray+";"+cleandate+';<%=result[0].num%>;<%=result[0].orderkey%>;s;<%=result[0].manager%>'+';'+h_ranker+';<%=client[0].rcgt?client[0].rcgt.split("~")[0].replace(/-/g,"").replace(/ /g,""):""%>;'+h_regident});
                                                socket_chk = 1;
                                                Swal.fire({
                                                    title: '계약진행중입니다.',
                                                    showConfirmButton:false,
                                                    didOpen: () => {
                                                        Swal.showLoading();
                                                    },
                                                    allowOutsideClick: false,
                                                });
                                            }
                                        }
                                    });
                                }
                            });  
                        }
                    }
                });
                $("#datepicker5" ).datepicker({
                    changeMonth: true,
                    changeYear: true
                });
                $("#datepicker5" ).datepicker( "option", "showAnim", "slide" );
                $("#datepicker5").val(chan_val);
            }else if(x=='stopr'){
                let ccnow = new Date();
                let checkDate = new Date('2025-04-01T08:00:00');
            
            if (ccnow < checkDate) {
                Swal.fire({//
                    width:'40%',
                    icon: 'warning',
                    title: '건강보험공단 전산시스템 점검',
                    html: `보건복지부 사회보장정보시스템의 점검으로 인하여  ‘복지용구 급여계약’이 불가능
하오니 업무에 참조하시기 바랍니다.<br/>
 ○ 중단일시 : 25.3.28.(금) 08:00 ~  25.4.1.(화) 08:00<br/>
 ○ 중단업무 : 사회보장정보시스템(행복e음, 범정부) 서비스 전반<br/>
  ※ 해당기간 동안 '복지용구 급여계약' 업무를 중단하여 주시기 바랍니다.<br/>
  ※ 긴급히 공지 드린 점 양해부탁드립니다.`,
                });
                return 0;
            }
                $.ajax({
                    url:'/rentstoptable',
                    data:'company=<%=result[0].company%>&key='+key,
                    dataType:'JSON',
                    type:'POST',
                    success:function(result){
                        if(result.code==200){
                            var cnow = new Date(ymdformat(result.data[0].stopdates));
                            var yesterday2 = new Date(cnow.setDate(cnow.getDate() + 1));
                            var ryear = yesterday2.getFullYear();
                            var rmon = (yesterday2.getMonth() + 1) > 9 ? '' + (yesterday2.getMonth() + 1) : '0' + (yesterday2.getMonth() + 1);
                            var rday = yesterday2.getDate() > 9 ? '' + yesterday2.getDate() : '0' + yesterday2.getDate();
                            var rentstopstartdate2= ryear+rmon+rday;
                            console.warn(rentstopstartdate2);
                            
                            var yesterday = cnow;
                            var yyear = yesterday.getFullYear();
                            var ymon = (yesterday.getMonth() + 1) > 9 ? '' + (yesterday.getMonth() + 1) : '0' + (yesterday.getMonth() + 1);
                            var yday = yesterday.getDate() > 9 ? '' + yesterday.getDate() : '0' + yesterday.getDate();
                            var cleandate = yyear+ymon+yday;
                            confirmdatatxt="";
                            for(var i=0; i<$('.gongbcodetxt').length; i++){
                                confirmdatatxt += '<tr class="adddata"><td class="pcode mobile">'+$('.pdfcode').eq(i).text()+'</td><td class="gongbcode cbcode">'+$('.gongbcodetxt').eq(i).val()+'</td><td class="cproductname">'+$('.gongnametxt').eq(i).text()+'</td><td><input class="sdate" id="datepicker5" type="text" style="width:100%; height:30px; width:90%; font-weight:bold;" value="'+chan_val+'"></td><td><input class="edate" id="datepicker6" type="text" style="width:100%; height:30px; width:90%; font-weight:bold;" value="'+nextdatearray[0][1]+'"></td></tr>';
                            }
                            confirmdatatxt += '</table><br/>';

                            Swal.fire({
                                width: '700px',
                                fontsize:'15px',
                                title: '대여 중지 재시작 하시겠습니까?',
                                html: '<table class="confirmtable">'+
                                '<tr>'+
                                '<td class="mobile">품목코드</td><td>바코드</td><td>품목명</td><td>재시작일</td><td>종료일</td>'+
                                '</tr>'+confirmdatatxt,
                                icon: 'question',
                                //input: 'select',
                                //inputOptions: list,
                                //inputPlaceholder: '회수차량선택',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: '확인',
                                cancelButtonText: '취소',
                                allowOutsideClick: false,
                            }).then((resultt) => {
                                if (resultt.isConfirmed) {
                                    console.warn(result.data[0].stopundo);
                                    console.warn($('.sdate').eq(0).val().replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))
                                    if(new Date(result.data[0].stopdates)>new Date($('.sdate').eq(0).val().replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))){
                                        Swal.fire(
                                            '이전 종료일보다 재시작일이 작습니다.',
                                            '',
                                            'error',
                                        );
                                    }else{
                                        $.ajax({
                                            url:'/stopcleantable',
                                            data:'company=<%=result[0].company%>&bcode='+ $('.gongbcodetxt').eq(0).val(),
                                            dataType:'JSON',
                                            type:'POST',
                                            success:function(result){
                                                if(result.code==200){
                                                    var pcodelist = [];
                                                    var cbcodelist = [];
                                                    var cproductnamelist = [];
                                                    var cproductnamelist2 = [];
                                                    var cdatelist = [];
                                                    var cdatelist2 = [];
                                                    var sdate = [];
                                                    var canclex = [];
                                                    var rentproduct = [];
                                                    $.each($('.gongbcodetxt'),function(i){
                                                        rentproduct.push($('.pcode').eq(i).text()+"|"+$('.cproductname').eq(i).text());
                                                        pcodelist.push($('.pcode').eq(i).text());
                                                        cbcodelist.push($('.cbcode').eq(i).text().replace(/ /g, ""));
                                                        cproductnamelist.push($('.cproductname').eq(i).text());
                                                        cproductnamelist2.push($('.pdfname').eq(i).text());
                                                        cdatelist.push($('.sdate').eq(i).val().replace(/(\-|\/)/g,''));
                                                        cdatelist2.push($('.edate').eq(i).val().replace(/(\-|\/)/g,''));
                                                    });
                                                    
                                                    var phonenum = '<%=result[0].phone%>';
                                                    phonenum = phoneNumber(phonenum.replace(' ',''));
                                                    if(cdatelist.length>0){
                                                        if(new Date(cdatelist[0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))>new Date(nextdatearray[nextdatearray.length-1][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))){
                                                            nextdatearray.pop();
                                                        }
                                                    }
                                                    $.ajax({
                                                        url:'/rentrestart',
                                                        data:'company=<%=result[0].company%>&key='+key+'&sdate='+$('.sdate').eq(0).val().replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'),
                                                        dataType:'JSON',
                                                        type:'POST',
                                                        success:function(result2){
                                                            if(result2.code==200){
                                                                socket.emit('disconnect2', {'name': uid});
                                                                socket.emit('login', {'name': uid});
                                                                socket.emit('rentcontract', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>;<%=result[0].guardname%>;<%=result[0].guardtarget%>;'+phonenum+';'+cbcodelist+";"+cproductnamelist2+";"+pcodelist+";"+cdatelist+";"+cdatelist2+";"+result.data[0].companyname+";"+result.data[0].companynumber+";;"+result.data[0].meditxt+";"+result.data[0].mediname+";"+result.data[0].medisize+";same;"+datetotal+";"+nextdatearray+";"+cleandate+';'+result2.rentkey+';'+result2.orderkey+';r;<%=result[0].manager%>'+';'+h_ranker+';'+h_rcgt+';'+h_regident});
                                                                socket_chk = 1;
                                                                Swal.fire({
                                                                    title: '계약진행중입니다.',
                                                                    showConfirmButton:false,
                                                                    didOpen: () => {
                                                                        Swal.showLoading();
                                                                    },
                                                                    allowOutsideClick: false,
                                                                });
                                                            }else{
                                                                Swal.fire(
                                                                    '오류발생(담당자문의)',
                                                                    '',
                                                                    'error',
                                                                );
                                                            }
                                                            
                                                        }
                                                    });
                                                }else{
                                                    Swal.fire(
                                                        '기존 소독내역이 없습니다',
                                                        '',
                                                        'error',
                                                    );
                                                }
                                            }
                                        });
                                    }
                                }
                            });  
                            $("#datepicker5,#datepicker6" ).datepicker({
                                changeMonth: true,
                                changeYear: true
                            });
                            $("#datepicker5,#datepicker6" ).datepicker( "option", "showAnim", "slide" );
                            //$("#datepicker5,#datepicker6").val(chan_val);
                        }
                    }
                });    
            }else if(x=='backcancle'){
                $.ajax({ 
                    url: "/deliverycarlist2", 
                    data: "company=" + company,
                    type: 'POST',
                    dataType: "JSON", 
                    success: function (result) { 
                        $.each(result.result,function(i){
                            list[result.result[i].car] = result.result[i].car;
                        });
                        Swal.fire({
                            width: '500px',
                            fontsize:'15px',
                            title: '회수취소 하시겠습니까?',
                            text: "회수취소 하시겠습니까?",
                            html: "<div style='display:flex; flex-direction:column; justify-content:center; align-items:center;'><div style='font-weight:bold; font-size:17px;'>회수취소일</div><input id='datepicker5' type='text' style='height:25px; width:120px; text-align:center; font-weight:bold; font-size:16px;'></div>",
                            icon: 'question',
                            //input: 'select',
                            //inputOptions: list,
                            //inputPlaceholder: '회수차량선택',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: '확인',
                            cancelButtonText: '취소',
                            allowOutsideClick: false,
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $.ajax({
                                    url: "/nrentdelivery2",
                                    data: "id=" + uid + "&company=" + company+ "&num="+key + "&orderkey=<%=result[0].orderkey%>"+ "&car="+$('.swal2-select').val(),
                                    type: 'POST',
                                    dataType: "JSON",
                                    success: function (result) {
                                        if(result){
                                        Swal.fire(
                                            '회수취소되었습니다.',
                                            '',
                                            'success'
                                        ).then((result) => {
                                        if (result.isConfirmed) {
                                            window.parent.location.reload();
                                            }
                                        });
                                        }else{
                                        Swal.fire(
                                            '삭제주문이 없습니다.',
                                            '',
                                            'error'
                                        );
                                        }
                                    }
                                });
                            }
                        });
                        $("#datepicker5" ).datepicker({
                            changeMonth: true,
                            changeYear: true
                        });
                        $("#datepicker5" ).datepicker( "option", "showAnim", "slide" );
                        $("#datepicker5").val(chan_val);
                    }
                });
            }    
        }   

        var productcode = "<%=result[0].productname%>";
        var productcodesplit = productcode.split(",");
        var productcoderesult1 = [];
        var productcoderesult2 = [];
        $.each(productcodesplit,function(i){
            productcodesplit2 = productcodesplit[i].split('|');
            productcoderesult1.push(productcodesplit2[0]);
            productcoderesult2.push(productcodesplit2[1]);
        });
        var i=0;
        orderuproad('<%=result[0].number%>');
        var h_ranker = '';
        var h_rcgt = '';
        var h_regident = '';
        $(window).load(function(){
            var buycnt = "1";
            var buycntsplit = buycnt.split(',');
            var buychk = "<%=result[0].class%>";
            var buychksplit = buychk.split(',');
            var buybcode = "<%=result[0].buybcode%>";
            var buybcodesplit = buybcode.split(',');
            var rentchk = "<%=result[0].productname%>";
            while(i<productcoderesult1.length){
                orderupproductload(productcoderesult1[i],buycntsplit[i],buychksplit[i],buybcodesplit[i],rentchk);
                i+=1;
            }
            ordermodify_client_get_history().then(res2=>{
                if(res2[0].code==200){
                    if(res2[0].data[0].rcgt==""){
                        socket.emit('disconnect2', {'name': uid});
                        socket.emit('login', {'name': uid});
                        // socket.emit('message', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>'});
                        socket.emit('go_lookup_req', { 'name':uid, 'cname':'<%=result[0].name%>', 'cnumber':'<%=result[0].number%>', 'agent':'' , 'target':'', 'company':company, 'date':date_now().replace(/-/g,'') });
                    }else{
                        h_ranker = res2[0].data[0].ranker.replace("등급","");
                        h_rcgt = res2[0].data[0].rcgt.split('~')[0].replace(/ |-/g,'');
                        h_regident = res2[0].data[0].regident.replace(/ |-/g,'');
                        $('.reloading').hide();
                        // if(new Date(ymdformat($('.gongstarttxt').eq(0).val()))>new Date(ymdformat(h_rcgt))){
                        let rentstart_target = $('.gongstarttxt').eq(0).val();
                        if("<%=result[0].chk%>"=="ok"){
                            rentstart_target = $('.gongendtxt').eq(0).val();
                            var startd = new Date(rentstart_target.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
                            startd.setDate(startd.getDate() + 1);
                            rentstart_target = datef(startd);
                            console.log(rentstart_target)
                        }else if("<%=result[0].rentchk%>"=="s"){
                            let startd = new Date();
                            rentstart_target = datef(startd);
                        }
                        client_log_get(rentstart_target).then(res3=>{
                            if(res3.code==200){
                                h_ranker = res3.data[0].ranker;
                                h_rcgt = res3.data[0].rcgtfr;
                                console.log("h_rcgt",h_rcgt,h_ranker)
                            }
                        });
                        
                        // }
                    }
                }
                
            });
        });
    </script>

    <div class="popup2" data-popup="popup-2">
        <div class="popup2-inner">
            <div class="popup2container">
            <div class="popup2topmenu">
                <section class="container">
                <div class="buttons">
                    <!-- Start of Button 1 -->
                    <a href="#none" class="btn-1 on">내 창고</a>
                    <!-- End of Button 1 -->
                    
                    <!-- Start of Button 2 -->
                    <a href="#none" class="btn-1">조아라이프</a>
                    <!-- End of Button 2 -->
                    
                    <!-- Start of Button 3 -->
                    <a href="#none" class="btn-1">케어맥스</a>
                    <!-- End of Button 3 -->
                    
                    <!-- Start of Button 4 -->
                    <a href="#none" class="btn-1">도매 3</a>
                    <!-- End of Button 4 -->
                    
                </div>
            </section>
        </div>
            <div class="maincontainer2">
                <h1 class="title2"><span class="material-icons">business</span>&nbsp;&nbsp;&nbsp;&nbsp;내 창고</h1>
                <div class="search-form">
                    <input type="text" class="search-bar productsearch" name="query" placeholder=" 검색어를 입력하세요." onkeyup="if(window.event.keyCode==13){orderupproduct(1)}">
                    <input type="button" class="search-button material-icons" value="search" onclick="orderupproduct(1)"; >
                </div>
                <table class="topmenu">
                    <tr>
                        <td>조회된 품목:&nbsp;&nbsp;<span class="totalcount">명</span></td>
                    </tr>
                </table>
                <div class="tablescroll">
                <table class="table table-bordered">
                    <tr class="tablemenu">
                        <td style="display:none;" class="tablenum" colspan="20">
  
                        </td>
                    </tr>
                    
                    <tr class="center tablemenu">
                        <td style="display:none;">번호</td>
                        <td style="width:120px;">품목</td>
                        <td>품목코드</td>
                        <td>품목명</td>
                        <td style="width:60px;">구입/대여</td>
                        <td style="width:150px;">급여/비급여</td>
                        <td>출고단가</td>
                        <td>보유재고</td>
                    </tr>

                </table>
                </div>
                </div>
            </div>
            <a class="popup2-close3" data-popup-close2="popup-2" href="#">x</a>
            
        </div>
    </div>
    
    <script>
        function pdfPrint(){ 
            $('iframe[name="print1"]').contents().find('body').scrollTop(0);
            // 현재 document.body의 html을 A4 크기에 맞춰 PDF로 변환 
        //     html2canvas($('iframe[name="print1"]').contents().find('html'), { onrendered: function (canvas) { 
        //         // 캔버스를 이미지로 변환 
        //         var imgData = canvas.toDataURL('image/png'); 
        //         var imgWidth = 210; 
        //         // 이미지 가로 길이(mm) A4 기준 
        //         var pageHeight = imgWidth * 1.414; 
        //         // 출력 페이지 세로 길이 계산 A4 기준 
        //         var imgHeight = canvas.height * imgWidth / canvas.width; 
        //         var heightLeft = imgHeight; 
        //         var doc = new jsPDF('p', 'mm'); 
        //         var position = 0; 
        //         // 첫 페이지 출력 
        //         doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight); 
        //         heightLeft -= pageHeight; 
        //         // 한 페이지 이상일 경우 루프 돌면서 출력 
        //         while (heightLeft >= 20) { 
        //             position = heightLeft - imgHeight; doc.addPage(); 
        //             doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight); 
        //             heightLeft -= pageHeight; 
        //         } 
        //         // 파일 저장 
        //         doc.save(uid+'.pdf'); 
        //         //이미지로 표현 
        //         //document.write('<img src="'+imgData+'" />'); 
        //     } 
        // }); 
    }

        // const doc = new jsPDF({
        //     //orientation: "landscape",
        //     orientation: "portrait",
        //     format: "a4"
        // });
        
        function pdfchange(){
            // doc.addHTML($('iframe[name="print1"]').contents().find('html'),function() {
            //     doc.save('html.pdf');
            // });
        }

        function printing(){
            window.frames["print1"].print();
        }

        function exelchange(){
            $('iframe[name="print1"]').contents().find('table').table2excel({
                exclude: ".excludeThisClass",
                name: uid,
                filename: uid, 
                preserveColors: false 
            });
        }

        function imgchange(){
            $('iframe[name="print1"]').contents().find('body').scrollTop(0);
        //    html2canvas($('iframe[name="print1"]').contents().find('html'), {
        //         onrendered: function(canvas) {
        //             canvas.toBlob(function(blob) {
        //                 saveAs(blob, 'image.png');
        //         });
        //         }
        //     });
        }

        function iframechange(w,d){
            if(w=='rent'){ 
                $('#print1').attr('src',"//xn--9o7b95g.com/rent");
                $(d).addClass('on');
                $('.on').not(d).removeClass('on');
                $('.on').not(d).addClass('off');
                $('.popup4-inner').css({"max-width":"1000px"});
            }
            if(w=='rent2'){
                $('#print1').attr('src',"//xn--9o7b95g.com/buy2");
                $(d).addClass('on');
                $('.on').not(d).removeClass('on');
                $('.on').not(d).addClass('off');
                $('.popup4-inner').css({"max-width":"1400px"});
            }
            if(w=='rent3'){
                $('#print1').attr('src',"//xn--9o7b95g.com/rent2");
                $(d).addClass('on');
                $('.on').not(d).removeClass('on');
                $('.on').not(d).addClass('off');
                $('.popup4-inner').css({"max-width":"1000px"});
            }
            $('#print1').load(function(){
                printiframedata(w);
            });
        }
    </script>
    
    <div class="popup4" data-popup4="popup-4">
        <div class="popup4-inner">
            <iframe id="print1" name="print1" src="//xn--9o7b95g.com/rent" frameborder="0"></iframe>
            <div class="print1footer">
                <div>
                    <div style="display:none;" class="flex" onclick="iframechange('buy',this);"><span>판매</span><span class="material-icons">note</span></div>
                    <div class="flex on" onclick="iframechange('rent',this);"><span>급여제공기록지</span><span class="material-icons">note</span></div>
                    <div class="flex" onclick="iframechange('rent2',this);"><span>공급계약서</span><span class="material-icons">note</span></div>
                    <div class="flex" onclick="iframechange('rent3',this);"><span>제품설치대장</span><span class="material-icons">note</span></div>
                </div>
                <div>
                    <div style="display:none;"class="flex" onclick="exelchange();"><span>EXEL변환</span><span class="material-icons green">assignment</span></div>
                    <div class="flex" onclick="pdfPrint();"><span>PDF변환</span><span class="material-icons red">picture_as_pdf</span></div>
                    <div class="flex" onclick="imgchange();"><span>이미지변환</span><span class="material-icons blue">collections</span></div>
                    <div class="flex" onclick="printing();"><span>프린트출력</span><span class="material-icons">print</span></div>
                </div>
            </div>
            <a class="popup4-close" data-popup-close4="popup-4" href="#">x</a>
        </div>
    </div>
    
    <section class="modal modal-section type-confirm">
        <div class="enroll_box">
            <p class="menu_msg"></p>
            <div class="flex">
                <table class="confirmtable">
                    <tr>
                        <td>선택</td><td>바코드</td><td>품목명</td><td>계약시작</td><td>계약종료</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="enroll_btn">
            <button class="btn gray_btn modal_close">계약</button>
            <button class="btn white_btn modal_close">닫기</button>
        </div>
    </section>
    <a style="display:none;" class="btn" data-guide-open="guide-1" href="#">Open guide #1</a>

        <div class="guide" data-guide="guide-1">
            <div class="guide-inner" style="display:none;">
                <a class="guide-close" data-guide-close="guide-1" href="#">x</a>
            </div>
        </div>
    <script>
        var confirmdatatxt = "";
        
        function datef(x){
            var year= x.getFullYear();
            var mon = (x.getMonth()+1)>9 ? ''+(x.getMonth()+1) : '0'+(x.getMonth()+1);
            var day = x.getDate()>9 ? ''+x.getDate() : '0'+x.getDate();
            var chan_val = year +"" + mon +"" + day;
            return chan_val;
        }

        function addzero(n){                        // 한자리가 되는 숫자에 "0"을 넣어주는 함수
                return n < 10 ? "0" + n: n;
            }
    
        function dateInput(n,m,d){
            console.warn(d)
            var date = new Date(d.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
            console.warn(date)
            var start = new Date(Date.parse(date)-n* 1000 * 60 * 60 * 24);
            var today = new Date(Date.parse(date)-m* 1000 * 60 * 60 * 24);
            
            if(n < 10){
                start.setDate(start.getDate()-n);
            }
            var yyyy = start.getFullYear();
            var mm = start.getMonth()+1;
            var dd = start.getDate();
            
            var t_yyyy = today.getFullYear();
            var t_mm = today.getMonth()+1;
            var t_dd = today.getDate();
            
            return yyyy+addzero(mm)+addzero(dd);
            //return t_yyyy+'-'+addzero(t_mm)+'-'+addzero(t_dd);
        
        }
        
        
        var now = new Date();
        var year= now.getFullYear();
        var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
        var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();         
        var chan_val = year +"" + mon +"" + day;
        
        async function ordermodify_client_get_history(rent_cont_add_start){
            return axios({
                method:'post',
                url:'/OrdermodifyClientGetHistory',
                data:{
                    company:company,
                    name:"<%=result[0].name%>",
                    number:"<%=result[0].number%>"
                }
            }).then(res=>{
                const data = res.data;
                return [data,rent_cont_add_start];
            });
        }

        async function client_log_get(rentstart){
            return axios({
                method:'post',
                url:'/ClientLogGet',
                data:{
                    number:"<%=result[0].number%>",
                    rentstart:rentstart
                }
            }).then(res=>{
                const data = res.data;
                return data;
            });
        }


        // var h_ranker = '';
        // var h_rcgt = '';
        // var h_regident = '';
        // ordermodify_client_get_history().then(res2=>{
        //     if(res2[0].code==200){
        //         if(res2[0].data[0].rcgt==""){
        //             socket.emit('disconnect2', {'name': uid});
        //             socket.emit('login', {'name': uid});
        //             // socket.emit('message', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>'});
        //             socket.emit('go_lookup_req', { 'name':uid, 'cname':'<%=result[0].name%>', 'cnumber':'<%=result[0].number%>', 'agent':'' , 'target':'', 'company':company, 'date':date_now().replace(/-/g,'') });
        //         }else{
        //             h_ranker = res2[0].data[0].ranker.replace("등급","");
        //             h_rcgt = res2[0].data[0].rcgt.split('~')[0].replace(/ |-/g,'');
        //             h_regident = res2[0].data[0].regident.replace(/ |-/g,'');
        //             $('.reloading').hide();
        //         }
        //     }
            
        // });
        function showOtherInput(select) {
            const otherInput = select.nextElementSibling;
            if (select.value === '기타') {
                otherInput.style.display = 'block';
            } else {
                otherInput.style.display = 'none';
                otherInput.value = '';
            }
        }
        /*공단계약하기 판매/대여확인 */
        
        function confirmchk(x){
            let ccnow = new Date();
            let checkDate = new Date('2025-04-01T08:00:00');
            
            if (ccnow < checkDate) {
                Swal.fire({//
                    width:'40%',
                    icon: 'warning',
                    title: '건강보험공단 전산시스템 점검',
                    html: `보건복지부 사회보장정보시스템의 점검으로 인하여  ‘복지용구 급여계약’이 불가능
하오니 업무에 참조하시기 바랍니다.<br/>
 ○ 중단일시 : 25.3.28.(금) 08:00 ~  25.4.1.(화) 08:00<br/>
 ○ 중단업무 : 사회보장정보시스템(행복e음, 범정부) 서비스 전반<br/>
  ※ 해당기간 동안 '복지용구 급여계약' 업무를 중단하여 주시기 바랍니다.<br/>
  ※ 긴급히 공지 드린 점 양해부탁드립니다.`,
                });
                return 0;
            }
            if($('.bcodeinput').eq(0).val()==''){
                Swal.fire(
                    '바코드 미입력',
                    '품목 바코드를 입력해주세요',
                    'warning'
                );
            }else if("<%=result[0].guardtarget%>"=='null'){
                Swal.fire(
                    '수급자 관계 미지정',
                    '해당 주문서에서 수급자관계를 수정해주세요',
                    'warning'
                );
            }else{
                
                var cnow = new Date(ymdformat($('.gongstarttxt').eq(0).val()));
                var yesterday = new Date(cnow.setDate(cnow.getDate() - 1));
                var yyear = yesterday.getFullYear();
                var ymon = (yesterday.getMonth() + 1) > 9 ? '' + (yesterday.getMonth() + 1) : '0' + (yesterday.getMonth() + 1);
                var yday = yesterday.getDate() > 9 ? '' + yesterday.getDate() : '0' + yesterday.getDate();
                var cleandate = yyear+ymon+yday;
                confirmdatatxt="";
                var txt = "계약시작일";
                var txt2 = "계약종료일";
                if(x=='n'||x=='m'){
                    console.log(rentend,$('.gongendtxt').eq(0).val())
                    if(rentend.replace(/\-/g,'')==$('.gongendtxt').eq(0).val()){
                        Swal.fire(
                            '계약종료일을 수정해주세요',
                            '취소계약종료일이 기존 계약종료일과 동일합니다. 종료일을 변경해주세요',
                            'warning'
                        );
                        return false;
                    }
                    txt = '계약종료일';
                    txt2 = '사유';
                    cicon = 'warning';
                    for(var i=0; i<$('.gongbcodetxt').length; i++){
                        if(parseInt(dateInput(1,0,$('.gongstarttxt').eq(i).val()))>parseInt($('.gongendtxt').eq(i).val())){
                            Swal.fire(
                                '계약일 오류',
                                '계약종료일이 시작일보다 작습니다',
                                'warning'
                            );
                            return 0;
                        }
                        confirmdatatxt += `
                        <tr class="adddata">
                            <td><input class="chking" type="checkbox" checked disabled></td>
                            <td class="pcode mobile">`+$('.pdfcode').eq(i).text()+`</td>
                            <td class="">
                                <input class="cbcode bcodeinput" style="height:20px; font-weight:bold;" type="text" value="`+$('.gongbcodetxt').eq(i).val()+`">
                            </td>
                            <td class="cproductname">`+$('.gongnametxt').eq(i).text()+`</td>
                            <td class="edate" style="color:#d45454;">`+$('.gongendtxt').eq(i).val()+`</td>
                            <td>
                                <select class="canclex" style="height:30px;" onchange="showOtherInput(this);">
                                    <option value="반품">반품</option>
                                    <option value="착오계약">착오계약</option>
                                    <option value="자격변동">자격변동</option>
                                    <option value="기타">기타</option>
                                </select>
                                <input type="text" class="canclex-other" style="height:30px; display:none; margin-top:5px;" placeholder="사유 직접 입력">
                            </td>
                        </tr>`;
                    }
                }else if(x=='y'){
                    if(window.parent.guide_chk==8){
                        window.parent.guide_on_ordermodify_3_7();
                    }
                    let companynumber2_txt = '';
                    for(var i=0; i<$('.gongbcodetxt').length; i++){
                        
                        if(parseInt($('.gongstarttxt').eq(i).val())>parseInt($('.gongendtxt').eq(i).val())){
                            Swal.fire(
                                '계약일 오류',
                                '계약시작일이 종료일보다 큽니다',
                                'warning'
                            );
                            return 0;
                        }
                        confirmdatatxt += `
                        <tr class="adddata">
                            <td><input type="checkbox" checked></td><td class="pcode mobile">`+$('.pdfcode').eq(i).text()+`</td>
                            <td class="gongbcode cbcode">`+$('.gongbcodetxt').eq(i).val()+`</td>
                            <td class="cproductname">`+$('.gongnametxt').eq(i).text()+`</td><td class="sdate">`+$('.gongstarttxt').eq(i).val()+`</td>
                            <td class="edate">`+$('.gongendtxt').eq(i).val()+`</td>
                        </tr>`;
                        companynumber2_txt += `<div class="companynumber2_bcode">바코드:`+$('.gongbcodetxt').eq(i).val()+`</div>
                        <input type="text" class="companynumber2" style="height:30px;" onchange="cleantable(this);" placeholder="위탁업체 필증번호 입력">
                        `; 
                    }
                    confirmdatatxt += `
                        </table>
                        <br/>
                        <div style="display:flex; width:100%; flex-direction:column; align-items:center; justify-content:center; font-weight:bold;">
                            <div class="clean_ment" style="color:#ff0000;">*신규 품목은 소독절차를 자동생략합니다.</div>
                            <br/>
                            <div>[소독구분]</div>
                            <br/>
                            <div>
                                <span>
                                    <input type="radio" id="c1" name="clean" class="clean_self" value="자체" onclick="clean(this);" checked>
                                </span>
                                <label for="c1" class="clean_self">자체</label>
                                <span>
                                    <input type="radio" id="c2" name="clean" class="clean_rental" value="위탁" onclick="clean(this);">
                                </span>
                                <label for="c2" class="clean_rental">위탁</label>
                                <select class="clean_chk" style="" onchange="clean_chk(this)">
                                    <option value="new">신규</option>
                                    <option value="old">반납</option>
                                </select>
                                <span>
                                    <input type="radio" id="c3" name="clean" class="clean_same" value="동일" onclick="clean(this);">
                                </span>
                                <label for="c3" class="clean_rental">동일인</label>
                            </div>
                            <br/>
                            <div class="clean_area">소독일자</div>
                            <div class="clean_area">
                                <input id="datepicker4" type="text" style="height:30px; width:100px; font-size:15px; font-weight:bold; text-align:center;" value="`+cleandate+`">
                            </div>
                            <div style="" class="medi flexcol clean_area">
                                <span>소독업체명</span>
                                <span><input class="companyname" type="text" style="height:30px;" value="<%=company%>" onchange="cleantable(this);"></span>
                                <span>사업자등록번호</span>
                                <span><input type="text" class="companynumber" style="height:30px;" value="<%=bankresult[0].companynum%>" onchange="cleantable(this);"></span>
                                <span class="companynumber2_colum">소독필증번호</span>
                                <span class="flexcloumn">
                                    `+companynumber2_txt+`
                                </span>
                                <span>소독종류</span>
                                <span>
                                    <select class="meditxt" style="height:30px;" onchange="cleantable(this);">
                                        <option value="약물소독">약물소독</option>
                                        <option value="증기소독">증기소독</option>
                                        <option value="일광소독">일광소독</option>
                                        <option value="끓는물소독">끓는물소독</option>
                                    </select>
                                </span>
                                <span>약품명</span>
                                <span>
                                    <input type="text" class="mediname" style="height:30px;" onchange="cleantable(this);">
                                </span>
                                <span>사용량</span>
                                <span>
                                    <input type="text" class="size" style="height:30px;" onchange="cleantable();">
                                </span>
                            </div>`+
                        '</div>';
                }else if(x=='z'){
                    txt = '계약연장시작일';
                    txt2 = '계약연장종료일';
                    for(var i=0; i<$('.gongbcodetxt').length; i++){
                        var startd = new Date($('.gongendtxt').eq(i).val().replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
                        startd.setDate(startd.getDate() + 1);
                        let nextdatearray_last = new Date(nextdatearray[0][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'));
                        if(startd>nextdatearray_last){
                            $('.nxdrelookup').html("<span style='color:#ff1100; font-size:12px; font-weight:bold; padding:10px;'>! 연장계약시 적용구간 갱신 필요</span><span class='relookup' onclick='relookup();'>재조회</span>");
                            Swal.fire(
                                '연장계약 불가',
                                '대여계약 가능 적용구간 갱신이 필요합니다. 수급자 재조회를 진행해주세요',
                                'warning'
                            );
                            return 0;
                        }
                        confirmdatatxt += `
                        <tr class="adddata">
                            <td><input type="checkbox" checked></td><td class="pcode mobile">`+$('.pdfcode').eq(i).text()+`</td>
                            <td class="gongbcode cbcode">`+$('.gongbcodetxt').eq(i).val()+`</td>
                            <td class="cproductname">`+$('.gongnametxt').eq(i).text()+`</td>
                            <td class="sdate">`+datef(startd)+`</td>
                            <td class="edate"><input typoe="text" style="width:100px; height:30px;"></td>
                        </tr>`;
                    }
                }
                $('.confirmtable tr').not($('.confirmtable tr').first()).remove();
                //$('.confirmtable').append(confirmdatatxt);
                Swal.fire({
                    width: '800px',
                    fontsize:'13px',
                    title: '선택하신 품목을 계약 하시겠습니까?',
                    text: "계약 하시겠습니까?",
                    html:
                    '<div style="padding-bottom:10px; font-weight:bold; color:#ff0000;"></div>'+
                    '<table class="confirmtable" style="width:100%;">'+
                    '<tr>'+
                    '<td>선택</td><td class="mobile">품목코드</td><td>바코드</td><td>품목명</td><td>'+txt+'</td><td>'+txt2+'</td>'+
                    '</tr>'+confirmdatatxt+
                    '</table>',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '계약',
                    cancelButtonText: '취소',
                    allowOutsideClick: false,
                    didOpen: (toast) => {
                        if("<%=result[0].rental%>"==''&&"<%=result[0].cleancompany%>"==''){
                            cleantable2('자체');
                            $('.companynumber2,.companynumber2_colum,.clean_chk').hide();
                        }else{
                            console.warn("위탁");
                            cleantable2('위탁');
                            $('#c2').click();
                            $('.clean_chk').show();
                            $('.clean_area').hide();
                            //$('.companynumber2').val('');
                        }
                        if(window.parent.guide_chk==8){
                            Swal.disableButtons();
                        }
                    },
                    preConfirm: () => {
                        let companynumber2_chk = 0;
                        $('.companynumber2').each(function(i){
                            if($(this).val()=='')companynumber2_chk = 1;
                        });
                        if($('.clean_chk').val()=="old"&&companynumber2_chk==1){
                            Swal.showValidationMessage(`
                                <div style='color:#ff0000'>위탁업체에서 전달받은 소독필증번호를 입력해주세요</div>
                            `);
                            return false;
                            //$('.clean_area').after("<div style='color:#ff0000'>소독필증번호를 입력해주세요</div>");
                        }else{
                            
                            var pcodelist = [];
                            var cbcodelist = [];
                            var cproductnamelist = [];
                            var cproductnamelist2 = [];
                            var ccompanynumber2 = [];
                            var cdatelist = [];
                            var cdatelist2 = [];
                            var sdate = [];
                            var canclex = [];
                            var rentproduct = [];
                            $.each($('.gongbcodetxt'),function(i){
                                rentproduct.push($('.pcode').eq(i).text()+"|"+$('.cproductname').eq(i).text());
                                pcodelist.push($('.pcode').eq(i).text());
                                ccompanynumber2.push($('.companynumber2').eq(i).val());
                                if(x=='y'||x=='z')cbcodelist.push($('.cbcode').eq(i).text().replace(/ /g, ""));
                                if(x=='n'||x=='m')cbcodelist.push($('.cbcode').eq(i).val().replace(/ /g, ""));
                                cproductnamelist.push($('.cproductname').eq(i).text());
                                cproductnamelist2.push($('.pdfname').eq(i).text());
                                if(x=='y'||x=='z')cdatelist.push($('.sdate').eq(i).text().replace(/(\-)/g,''));
                                //$('.edate').eq(i).text($('.edate').eq(i).text().replace(/ /g, ""));
                                if(x=='z')cdatelist2.push($('.edate').eq(i).children('input').val().replace(/(\-|\/)/g,''));
                                if(x=='y'||x=='n'||x=='m')cdatelist2.push($('.edate').eq(i).text().replace(/(\-|\/)/g,''));
                                if(x=='n'||x=='m'){
                                    if($('.canclex').eq(i).val() == '기타'){
                                        canclex.push($('.canclex-other').eq(i).val());
                                    } else {
                                        canclex.push($('.canclex').eq(i).val());
                                    }
                                }
                            });

                            // $.ajax({ 
                            //     url: "/rentbcodemodify", 
                            //     data: "id=" + uid +"&company=" + company +"&key=" + key + "&rentbcode="+cbcodelist + "&rentproduct="+rentproduct,
                            //     type: 'POST',
                            //     dataType: "JSON", 
                            //     success: function (result) { 
                            //     } 
                            // });
                            let medichk = '';
                            if($('#c1').is(":checked")==true){
                                medichk = 'okmedi'; 
                            }else if($('#c2').is(":checked")==true){
                                medichk = 'nomedi';
                            }else if($('#c3').is(":checked")==true){
                                medichk = 'same';
                            }
                            socket.emit('disconnect2', {'name': uid});
                            socket.emit('login', {'name': uid});
                            
                            var phonenum = '<%=result[0].phone%>';
                            phonenum = phoneNumber(phonenum.replace(/ |-/g,''));
                            if(cdatelist.length>0){
                                if(new Date(cdatelist[0].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))>new Date(nextdatearray[nextdatearray.length-1][1].replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3'))){
                                    nextdatearray.pop();
                                }
                            }
                            if(x=='y')socket.emit('rentcontract', { 'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>;<%=result[0].guardname%>;<%=result[0].guardtarget%>;'+phonenum+';'+cbcodelist+";"+cproductnamelist2+";"+pcodelist+";"+cdatelist+";"+cdatelist2+";"+$('.companyname').val()+";"+$('.companynumber').val()+";"+ccompanynumber2+";"+$('.meditxt').val()+";"+$('.mediname').val()+";"+$('.size').val()+";"+medichk+";"+datetotal+";"+nextdatearray+";"+$('#datepicker4').val()+';<%=result[0].num%>;<%=result[0].orderkey%>;;<%=result[0].manager%>'+';'+h_ranker+';'+h_rcgt+';'+h_regident});
                            else if(x=='n')socket.emit('rentcancle', {'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>'+';'+cproductnamelist2+';'+canclex+";"+cdatelist2+";"+cbcodelist+";"+rentalchk+";"+pcodelist+';<%=result[0].num%>;<%=result[0].orderkey%>;c'});
                            else if(x=='m')socket.emit('rentmodify', {'name':uid, 'msg':'<%=result[0].name%>;<%=result[0].number%>'+';'+cproductnamelist2+';'+canclex+";"+cdatelist2+";"+cbcodelist+";"+rentalchk+";"+pcodelist+';<%=result[0].num%>;<%=result[0].orderkey%>'});
                            
                            if(x=='z'){
                                let rent_cont_add_start =$('.sdate').text().replace(/(\-)/g,'').replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3');
                                ordermodify_client_get_history(rent_cont_add_start).then(res2=>{
                                    if(res2[0].code==200){
                                        if(res2[0].data[0].rcgt==""){
                                        }else if(new Date(res2[0].data[0].rcgt.split('~')[1].replace(/ /g,''))<=new Date(res2[1])){
                                            //h_ranker = res2[0].data[0].rankernext;
                                            // h_rcgt = res2[0].data[0].rcgtnext.split('~')[0].replace(/ |-/g,'');
                                            h_regident = res2[0].data[0].regident.replace(/ |-/g,'');
                                        }else{
                                            //h_ranker = res2[0].data[0].ranker.replace("등급","");
                                            // h_rcgt = res2[0].data[0].rcgt.split('~')[0].replace(/ |-/g,'');
                                            h_regident = res2[0].data[0].regident.replace(/ |-/g,'');
                                            $('.reloading').hide();
                                        }
                                    }
                                    console.warn(h_rcgt,h_ranker)
                                    let rentconaddarr = ['<%=result[0].name%>;<%=result[0].number%>;<%=result[0].guardname%>;<%=result[0].guardtarget%>;'+phonenum+';'+cbcodelist+";"+cproductnamelist2+";"+pcodelist+";"+cdatelist+";"+cdatelist2+";"+$('.companyname').val()+";"+$('.companynumber').val()+";"+$('.companynumber2').val()+";"+$('.meditxt').val()+";"+$('.mediname').val()+";"+$('.size').val()+";"+medichk+";"+datetotal+";"+nextdatearray+";"+$('#datepicker4').val()+';n'+';<%=result[0].orderkey%>;<%=result[0].num%>'+';'+h_ranker+';'+h_rcgt+';'+h_regident];
                                    socket.emit('rentcontractadd', { 'name':uid, 'msg':rentconaddarr});
                                });
                            }
                            socket_chk = 1;
                            Swal.fire({
                                title: '계약진행중입니다.',
                                showConfirmButton:false,
                                didOpen: () => {
                                    Swal.showLoading();
                                },
                                allowOutsideClick: false,
                            });
                        }
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        if(window.parent.guide_chk==8){
                            window.parent.guide_on_ordermodify_3_9();
                        }
                        
                        
                        /*
                        $.ajax({
                            url: "/deleterow",
                            data: "id=" + uid + "&row=" + row,
                            type: 'POST',
                            dataType: "JSON",
                            success: function (result) {
                                if(row.length>0){
                                location.reload();
                                Swal.fire(
                                    '삭제되었습니다.',
                                    '',
                                    'success'
                                );
                                }else{
                                Swal.fire(
                                    '삭제주문이 없습니다.',
                                    '',
                                    'error'
                                );
                                }
                            }
                        });
                        */
                    }else{
                        if(window.parent.guide_chk==8){
                            window.parent.guide_on_ordermodify_2_3();
                        }
                    }
                });
                $("#datepicker4" ).datepicker({
                    changeMonth: true,
                    changeYear: true
                });
                $("#datepicker4" ).datepicker( "option", "showAnim", "slide" );
                
                /*
                action_popup.confirm("선택품목 계약을 진행하시겠습니까?", function (res) {
                    if (res) {
                        action_popup.close(this);
                    }
                });
                */
            }
        }

        function clean(x){
            if($(x).val()=="위탁") {
                //$('.medi').show(); 
                cleantable2($(x).val());
                $('.companynumber2,.companynumber2_colum,.clean_chk').show();
                $('.clean_area').hide();
            }else if($(x).val()=="자체"){
                //$('.medi').show(); 
                cleantable2($(x).val());
                $('.clean_area').show();
                $('.clean_chk').val('new').prop('selected',true);
                $('.companynumber2,.companynumber2_colum,.clean_chk').hide();

            }else{
                $('.clean_chk').val('new').prop('selected',true);
                $('.clean_area').hide();
                $('.clean_chk').hide();
            }
        }
    
        function cleantable(x){
            $.ajax({
                type: 'POST',
                url: '/cleantable',
                data: "company="+company+"&companyname="+$('.companyname').val()+"&companynumber="+$('.companynumber').val()+"&companynumber2="+$('.companynumber2').val()+"&meditxt="+$('.meditxt').val()+"&mediname="+$('.mediname').val()+"&size="+$('.size').val(),
                dataType: "JSON", 
                success: function (data) {
                }
            });
        }

        function clean_chk(x){
            if($(x).val()=='new'){
                $('.clean_area').hide();
            }else{
                $('.clean_area').show();
            }
        }
    
        function cleantable2(x){
            $.ajax({
                type: 'POST',
                url: '/cleantable2',
                data: "company="+company+"&key="+orderkey,
                dataType: "JSON", 
                success: function (res) {
                    const data = res;
                    if(data.code==200){
                        data.result.forEach(function(obj,index){
                            if(obj.date!='')$('#datepicker4').val(obj.date.replace(/[^0-9]/g,''));
                            $('.companyname').val(obj.companyname);
                            $('.companynumber').val(obj.companynumber);
                            $('.meditxt').val(obj.meditxt).prop("selected", true);
                            $('.mediname').val(obj.mediname);
                            $('.size').val(obj.size);
                            $('.companynumber2_bcode').each(function(){
                                if($(this).text().replace(/ /g,'').split(':')[1]==obj.bcode.replace(/ /g,'')){
                                    $(this).next().val(obj.cnum);
                                }
                            });
                        });

                    }else if(data.code==300){
                        if(x=='위탁'){
                            $('.companyname').val(data.result[0].companyname);
                            $('.companynumber').val(data.result[0].companynumber);
                            $('.companynumber2').val("");
                        }else if(x=='자체'){
                            $('.companyname').val('<%=company%>');
                            $('.companynumber').val('<%=bankresult[0].companynum%>');
                        }
                        $('.meditxt').val(data.result[0].meditxt).prop("selected", true);
                        $('.mediname').val(data.result[0].mediname);
                        $('.size').val(data.result[0].size);
                    }else{

                    }
                }
            });
        }
        
        var action_popup = {
            timer: 300,
            confirm: function (txt, callback) {
                if (txt == null || txt.trim() == "") {
                    console.warn("confirm message is empty.");
                    return;
                } else if (callback == null || typeof callback != 'function') {
                    console.warn("callback is null or not function.");
                    return;
                } else {
                    $(".type-confirm .btn_ok").on("click", function () {
                        $(this).unbind("click");
                        callback(true);
                        action_popup.close(this);
                    });
                    this.open("type-confirm", txt);
                }
            },

            alert: function (txt) {
                if (txt == null || txt.trim() == "") {
                    console.warn("confirm message is empty.");
                    return;
                } else {
                    this.open("type-alert", txt);
                }
            },

            open: function (type, txt) {
                var popup = $("." + type);
                popup.find(".menu_msg").text(txt);
                $("body").append("<div class='dimLayer'></div>");
                $(".dimLayer").css('height', $(document).height()).attr("target", type);
                popup.fadeIn(this.timer);
            },

            close: function (target) {
                var modal = $(target).closest(".modal-section");
                var dimLayer;
                if (modal.hasClass("type-confirm")) {
                    dimLayer = $(".dimLayer[target=type-confirm]");
                    $(".type-confirm .btn_ok").unbind("click");
                } else if (modal.hasClass("type-alert")) {
                    dimLayer = $(".dimLayer[target=type-alert]")
                } else {
                    console.warn("close unknown target.")
                    return;
                }
                modal.fadeOut(this.timer);
                setTimeout(function () {
                    dimLayer != null ? dimLayer.remove() : "";
                }, this.timer);
            }
        }
        
        $(document).ready(function(){
            
            need_get_data();
            $(".dimLayer").on("click", function () {
                action_popup.close(this);
            });
            socekt_start();
            rentmodify_cms_memeber_chk().then(res=>{
                if(res.code==200){
                    rentmodify_cms_rent_chk().then(res2=>{
                        console.warn(res2)
                        if(res2.code==200){
                            if(res2.data[0].cmschk==1){
                                toggleSwitch(1);
                            }else{
                                toggleSwitch(0);
                            }
                        }else{
                            Swal.fire('CMS 정보 확인 불가','CMS정보를 가져오지못했습니다','warning')
                        }
                    });
                    
                }else{
                    cms_chk_area(1);
                }
            });
        });

        $(".modal_close").on("click", function () {
                action_popup.close(this);
        });
        
    </script>
    
</body>
</html>